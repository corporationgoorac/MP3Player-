<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MP3 Player — corporationgoorac</title>
<meta name="description" content="Auto-load .mp3 from corporationgoorac/MP3Player- (root) — dark player">
<style>
:root{--bg-0:#031018;--bg-1:#071019;--muted:#98a4ad;--accent:#1db954;--text:#e8f0f4;--card:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));--radius:12px;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial}
*{box-sizing:border-box}html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));color:var(--text);-webkit-font-smoothing:antialiased}
.app{display:grid;grid-template-columns:380px 1fr;gap:18px;height:100vh;padding:20px}
.card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 10px 40px rgba(2,6,10,0.6);display:flex;flex-direction:column}
.cover{border-radius:12px;overflow:hidden;height:320px;background:linear-gradient(180deg,#061017,#071018);display:flex;align-items:center;justify-content:center}
.cover img{width:100%;height:100%;object-fit:cover;display:block}
.meta{margin-top:12px}
.title{font-weight:700;font-size:18px}
.artist{color:var(--muted);font-size:13px;margin-top:6px}
.controls{display:flex;align-items:center;gap:12px;margin-top:12px}
.btn{background:transparent;border:none;padding:10px;border-radius:10px;color:var(--text);cursor:pointer;backdrop-filter:blur(4px);font-size:18px}
.play{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,var(--accent),#16a84a);color:#01120a;font-weight:800;font-size:20px;border:none;cursor:pointer;box-shadow:0 8px 30px rgba(29,185,84,0.14)}
.seek-wrap{margin-top:12px}
input[type=range]{width:100%;-webkit-appearance:none;height:6px;border-radius:6px;background:rgba(255,255,255,0.04);outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 2px 6px rgba(0,0,0,0.4);cursor:pointer}
.time-row{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:8px}
.settings{display:flex;gap:8px;align-items:center;margin-top:12px}
.chip{background:#0b1316;padding:8px 12px;border-radius:999px;font-size:13px;color:var(--muted)}
.panel{background:transparent;border-radius:var(--radius);padding:8px;display:flex;flex-direction:column;min-height:0}
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:8px}
.search{flex:1;background:#071018;border-radius:10px;padding:10px 12px;display:flex;gap:10px;align-items:center;border:1px solid rgba(255,255,255,0.02)}
.playlist{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:12px;padding:8px;overflow:auto;flex:1}
.track{display:grid;grid-template-columns:64px 1fr 80px;gap:12px;align-items:center;padding:10px;border-radius:10px;cursor:pointer}
.track:hover{background:rgba(255,255,255,0.02)}
.track.active{background:linear-gradient(90deg, rgba(29,185,84,0.08), rgba(29,185,84,0.03));}
.thumb{width:64px;height:64px;border-radius:10px;overflow:hidden}
.name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sub{font-size:12px;color:var(--muted)}
.time{font-size:12px;color:var(--muted);text-align:right}
.mini{position:fixed;left:20px;right:20px;bottom:20px;height:72px;background:#071017;border-radius:12px;padding:10px;display:flex;align-items:center;gap:12px;box-shadow:0 18px 50px rgba(2,6,10,0.6)}
.mini .thumb{width:56px;height:56px;border-radius:8px;overflow:hidden}
.muted-small{font-size:12px;color:var(--muted)}
.status{font-size:13px;color:var(--muted);margin-top:8px}
@media(max-width:920px){.app{grid-template-columns:1fr;gap:12px;padding:12px}.cover{height:220px}}
</style>
</head>
<body>
  <div class="app" id="app">
    <div class="card">
      <div class="cover" id="cover"><img id="coverImg" alt="cover"></div>

      <div class="meta">
        <div class="title" id="trackTitle">Loading tracks...</div>
        <div class="artist" id="artistLabel">Siva Manihandan</div>
      </div>

      <div class="controls">
        <button class="btn" id="prevBtn" title="Previous">⏮</button>
        <button class="play" id="playBtn" title="Play/Pause">▶</button>
        <button class="btn" id="nextBtn" title="Next">⏭</button>
        <div style="flex:1"></div>
        <div class="chip" id="count">0 tracks</div>
      </div>

      <div class="seek-wrap">
        <input type="range" id="seek" min="0" max="100" value="0" />
        <div class="time-row"><span id="curTime">0:00</span><span id="durTime">0:00</span></div>
      </div>

      <div class="settings">
        <div class="chip"><label><input id="shuffle" type="checkbox" style="margin-right:8px">Shuffle</label></div>
        <div class="chip"><label><input id="repeat" type="checkbox" style="margin-right:8px">Repeat</label></div>
        <div style="flex:1"></div>
        <div class="chip" id="autoplayChip" title="Toggle autoplay">Autoplay: On</div>
      </div>

      <div class="status" id="status">Auto-loading MP3s from your repo...</div>
    </div>

    <div class="panel">
      <div class="toolbar">
        <div class="search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.9"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg><input id="filter" placeholder="Filter tracks..." /></div>
        <div><button class="btn" id="import" title="Import (file picker)">⤓</button></div>
      </div>

      <div class="playlist" id="playlist" role="list"></div>
      <div class="muted-small" style="margin-top:10px">This file is tailored to: <b>corporationgoorac/MP3Player- (branch: main)</b></div>
    </div>
  </div>

  <div class="mini" id="mini" title="Open player">
    <div class="thumb" id="miniThumb"><img id="miniImg" style="width:100%;height:100%;object-fit:cover"></div>
    <div style="flex:1">
      <div id="miniTitle" style="font-weight:700">No track</div>
      <div id="miniArtist" class="muted-small">Siva Manihandan</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn" id="miniPrev">⏮</button>
      <button class="play" id="miniPlay">▶</button>
      <button class="btn" id="miniNext">⏭</button>
    </div>
  </div>

  <audio id="player" preload="metadata"></audio>

<script>
/* Hard-coded GitHub repo loader for corporationgoorac/MP3Player- (main)
   - Loads all .mp3 files from repo root using GitHub API (public repo)
   - No drag & drop. Import file picker kept for local testing.
*/

const OWNER = 'corporationgoorac';
const REPO  = 'MP3Player-';
const BRANCH = 'main'; // branch to query

const AUDIO_RE = /\.mp3(\?.*)?$/i;
const DEFAULT_ARTIST = 'Siva Manihandan';

const player = document.getElementById('player');
const playlistEl = document.getElementById('playlist');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const seek = document.getElementById('seek');
const curTime = document.getElementById('curTime');
const durTime = document.getElementById('durTime');
const countEl = document.getElementById('count');
const filterInput = document.getElementById('filter');
const statusEl = document.getElementById('status');

const miniImg = document.getElementById('miniImg');
const miniTitle = document.getElementById('miniTitle');
const miniArtist = document.getElementById('miniArtist');
const miniPlay = document.getElementById('miniPlay');
const miniPrev = document.getElementById('miniPrev');
const miniNext = document.getElementById('miniNext');
const importBtn = document.getElementById('import');

let tracks = []; // {name, url, artist, thumb, duration}
let current = 0;
let isShuffle = false;
let isRepeat = false;
let autoplay = true;
player.volume = 1;

function log(s){ try{ console.log('[player] '+s); }catch(e){} }
function setStatus(s){ statusEl.textContent = s; log(s); }
function escapeHtml(s){ return String(s).replace(/[&<>"'`]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[c])); }
function fmtTime(s){ if(isNaN(s)||!isFinite(s)) return '0:00'; const m=Math.floor(s/60); const sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }
function hashCode(s){ let h=0; for(let i=0;i<s.length;i++){ h = ((h<<5)-h) + s.charCodeAt(i); h |= 0; } return h; }
function makeThumb(name){
  const initials = (name||'S').split(/[\s\-_]+/).map(t=>t[0]||'').slice(0,2).join('').toUpperCase();
  const colors = ['#1db954','#6b8bff','#ff7a7a','#9b6bff'];
  const color = colors[Math.abs(hashCode(name)) % colors.length];
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect width='100%' height='100%' fill='${color}'/><text x='50%' y='56%' font-size='140' text-anchor='middle' fill='rgba(255,255,255,0.95)' font-family='Inter,Arial' font-weight='800'>${escapeHtml(initials)}</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}
function makeCoverLetter(name){
  const letter = (String(name||'').trim()[0] || 'S').toUpperCase();
  const seed = Math.abs(hashCode(name)) % 360;
  const c1 = `hsl(${seed} 60% 35%)`; const c2 = `hsl(${(seed+40)%360} 60% 22%)`;
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='1024'><defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'><stop offset='0' stop-color='${c1}'/><stop offset='1' stop-color='${c2}'/></linearGradient></defs><rect width='100%' height='100%' fill='url(#g)'/><text x='50%' y='60%' font-size='520' text-anchor='middle' fill='rgba(255,255,255,0.95)' font-family="Inter,Arial" font-weight="900">${escapeHtml(letter)}</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

// render playlist
function render(filter=''){
  playlistEl.innerHTML = '';
  const filtered = tracks.filter(t => (t.name + ' ' + (t.artist||'')).toLowerCase().includes(filter.toLowerCase()));
  filtered.forEach((t) => {
    const i = tracks.indexOf(t);
    const row = document.createElement('div');
    row.className = 'track' + (i === current ? ' active' : '');
    row.dataset.index = i;
    row.innerHTML = `<div class="thumb"><img src="${t.thumb}" alt=""></div>
      <div style="min-width:0"><div class="name">${escapeHtml(t.name)}</div><div class="sub">${escapeHtml(t.artist||DEFAULT_ARTIST)}</div></div>
      <div class="time">${t.duration?fmtTime(t.duration):''}</div>`;
    row.addEventListener('click', ()=> playIndex(i));
    playlistEl.appendChild(row);
  });
  countEl.textContent = tracks.length + ' tracks';
  updateMini();
}
function updateMini(){
  const t = tracks[current];
  miniTitle.textContent = t ? t.name : 'No track';
  miniArtist.textContent = t ? (t.artist || DEFAULT_ARTIST) : DEFAULT_ARTIST;
  miniImg.src = t ? t.thumb : '';
  const paused = player.paused || !player.src;
  miniPlay.textContent = paused ? '▶' : '⏸';
  playBtn.textContent = paused ? '▶' : '⏸';
}
function setMeta(t){
  document.getElementById('trackTitle').textContent = t? t.name : 'No track';
  document.getElementById('artistLabel').textContent = t? (t.artist||DEFAULT_ARTIST) : DEFAULT_ARTIST;
  document.getElementById('coverImg').src = t ? makeCoverLetter(t.name) : '';
  if('mediaSession' in navigator && t){
    try{ navigator.mediaSession.metadata = new MediaMetadata({title:t.name, artist:t.artist||DEFAULT_ARTIST, album:'Local', artwork:[{src:t.thumb,sizes:'512x512'}]}); }catch(e){}
  }
}

// playback
function playIndex(i){ if(tracks.length===0) return; if(i<0) i=0; if(i>=tracks.length) i=0; current=i; const t = tracks[current]; player.src = t.url; setMeta(t); player.play().catch(()=>{}); render(filterInput.value); }
function playNext(){ if(isRepeat){ player.currentTime=0; player.play(); return; } if(isShuffle){ playIndex(Math.floor(Math.random()*tracks.length)); return; } playIndex((current+1)%tracks.length); }
function playPrev(){ if(player.currentTime>3){ player.currentTime=0; player.play(); return; } playIndex(Math.max(0,current-1)); }

player.addEventListener('timeupdate', ()=> { if(player.duration){ seek.value = (player.currentTime / player.duration) * 100; curTime.textContent = fmtTime(player.currentTime); durTime.textContent = fmtTime(player.duration); }});
player.addEventListener('loadedmetadata', ()=> { if(player.duration && tracks[current]){ tracks[current].duration = player.duration; render(filterInput.value); }});
player.addEventListener('ended', ()=> { if(autoplay) playNext(); else { playBtn.textContent='▶'; miniPlay.textContent='▶'; }});
seek.addEventListener('input', ()=> { if(player.duration) player.currentTime = (seek.value/100) * player.duration; });

playBtn.addEventListener('click', ()=> { if(!player.src && tracks.length){ playIndex(0); return; } if(player.paused){ player.play(); playBtn.textContent='⏸'; miniPlay.textContent='⏸'; } else { player.pause(); playBtn.textContent='▶'; miniPlay.textContent='▶'; }});
prevBtn.addEventListener('click', playPrev); nextBtn.addEventListener('click', playNext);
miniPrev.addEventListener('click', e=>{ e.stopPropagation(); playPrev(); }); miniNext.addEventListener('click', e=>{ e.stopPropagation(); playNext(); }); miniPlay.addEventListener('click', e=>{ e.stopPropagation(); playBtn.click(); });

filterInput.addEventListener('input', ()=> render(filterInput.value));
document.addEventListener('keydown', e=> { const tag=document.activeElement&&document.activeElement.tagName.toLowerCase(); if(tag==='input'||tag==='textarea') return; if(e.code==='Space'){ e.preventDefault(); playBtn.click(); } if(e.code==='ArrowRight') nextBtn.click(); if(e.code==='ArrowLeft') prevBtn.click(); });

// import button (kept)
importBtn.addEventListener('click', ()=> {
  const inp = document.createElement('input'); inp.type='file'; inp.multiple=true; inp.accept='.mp3';
  inp.onchange = ()=> { if(!inp.files) return; const files = Array.from(inp.files).filter(f => AUDIO_RE.test(f.name)); if(!files.length) return; tracks.forEach(t=> { if(t._blob) URL.revokeObjectURL(t.url); }); tracks = files.map(f => ({ name: f.name.replace(/\.[^/.]+$/,''), url: URL.createObjectURL(f), artist: DEFAULT_ARTIST, _blob:true, thumb: makeThumb(f.name.replace(/\.[^/.]+$/,'')) })); populateDurations().then(()=> { render(''); if(tracks.length) playIndex(0); setStatus('Loaded local files via import.'); }); };
  inp.click();
});

async function populateDurations(){
  const promises = tracks.map(t => new Promise(resolve => {
    if(t.duration && !isNaN(t.duration)) return resolve(t);
    const a = document.createElement('audio'); a.preload='metadata'; a.src = t.url;
    const tidy = ()=> { try{ a.remove(); }catch(e){} };
    const onmeta = ()=> { if(!isNaN(a.duration) && isFinite(a.duration)) t.duration = a.duration; tidy(); resolve(t); };
    const onerr = ()=> { tidy(); resolve(t); };
    a.addEventListener('loadedmetadata', onmeta, {once:true}); a.addEventListener('error', onerr, {once:true}); a.load();
    setTimeout(()=> { resolve(t); try{ a.remove(); }catch(e){} }, 6000);
  }));
  await Promise.all(promises);
}

// --- GitHub API listing tailored to your repo ---
async function loadFromGithubRoot(){
  try{
    setStatus('Querying GitHub API for repo root...');
    const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/?ref=${BRANCH}`;
    const res = await fetch(api, { headers: { 'Accept': 'application/vnd.github.v3+json' }});
    if(!res.ok){ setStatus('GitHub API returned ' + res.status + '. See console.'); console.error('GitHub API status', res.status, await res.text()); return false; }
    const json = await res.json();
    if(!Array.isArray(json)){ setStatus('Unexpected GitHub response. See console.'); console.log(json); return false; }
    const mp3items = json.filter(i => i.type === 'file' && AUDIO_RE.test(i.name));
    if(mp3items.length === 0){ setStatus('No mp3 files found in repo root.'); console.log('GitHub contents', json); return false; }
    tracks = mp3items.map(it => ({ name: it.name.replace(/\.[^/.]+$/,''), url: it.download_url, artist: DEFAULT_ARTIST, thumb: makeThumb(it.name) }));
    await populateDurations();
    setStatus(`Loaded ${tracks.length} MP3(s) from ${OWNER}/${REPO} (branch ${BRANCH}).`);
    render(); if(tracks.length) playIndex(0);
    return true;
  }catch(e){ setStatus('Error calling GitHub API (see console)'); console.error(e); return false; }
}

// Run on load
window.addEventListener('load', async ()=> {
  setStatus('Starting: loading mp3 list from GitHub repo root...');
  const ok = await loadFromGithubRoot();
  if(!ok){
    setStatus('Automatic loading from GitHub failed — check console or make sure repo is public and branch is correct.');
    document.getElementById('trackTitle').textContent = 'No tracks auto-detected';
    document.getElementById('artistLabel').textContent = 'Ensure repo public & files in root';
  } else {
    autoplay = true; document.getElementById('autoplayChip').textContent = 'Autoplay: On';
  }
});

// cleanup
window.addEventListener('beforeunload', ()=> { tracks.forEach(t=> { if(t._blob) URL.revokeObjectURL(t.url); }); });

</script>
</body>
</html>
