<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dark MP3 Player ‚Äî Siva Manihandan</title>
<style>
:root{
  --bg:#0b0f13; --panel:#111417; --muted:#9aa4b2; --accent:#1db954; --glass:rgba(255,255,255,0.03);
  --text:#e6eef3;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071018,#0b0f13);color:var(--text)}
.app{display:flex;gap:20px;padding:20px;height:100vh}
.left{width:340px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:16px;display:flex;flex-direction:column}
.cover{height:300px;border-radius:12px;background:linear-gradient(180deg,#15171a,#0f1113);display:flex;align-items:center;justify-content:center;overflow:hidden}
.cover img{width:100%;height:100%;object-fit:cover}
.meta{margin-top:12px}
.title{font-size:18px;font-weight:700}
.artist{color:var(--muted);font-size:13px;margin-top:6px}
.controls{display:flex;align-items:center;gap:10px;margin-top:14px}
.btn{background:var(--glass);border:none;padding:10px;border-radius:10px;cursor:pointer;color:var(--text)}
.btn.play{width:56px;height:56px;border-radius:12px;background:var(--accent);color:#071018;font-weight:700}
.progress{margin-top:14px}
.progress input[type=range]{width:100%}
.time-row{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px}
.right{flex:1;display:flex;flex-direction:column}
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.search{background:var(--panel);padding:10px;border-radius:12px;display:flex;gap:10px;align-items:center}
.search input{background:transparent;border:none;outline:none;color:var(--text);width:260px}
.playlist{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:12px;padding:10px;overflow:auto;flex:1}
.track{display:grid;grid-template-columns:40px 1fr 90px;align-items:center;padding:8px;border-radius:10px;gap:12px;cursor:pointer}
.track:hover{background:rgba(255,255,255,0.02)}
.track.active{background:linear-gradient(90deg, rgba(29,185,84,0.12), rgba(29,185,84,0.04));}
.track .num{opacity:.7;text-align:center}
.track .name{font-weight:600}
.track .sub{font-size:12px;color:var(--muted)}
.bottom-bar{display:flex;align-items:center;gap:12px;margin-top:12px}
.chip{background:var(--panel);padding:8px 12px;border-radius:999px;font-size:13px}
.hint{color:var(--muted);font-size:13px}
.tog{display:inline-flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
.mini-player{position:fixed;left:12px;right:12px;bottom:12px;height:68px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:8px;display:flex;align-items:center;gap:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6);cursor:pointer}
.mini-cover{width:52px;height:52px;border-radius:8px;overflow:hidden}
.mini-info{flex:1;min-width:0}
.mini-title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.mini-artist{font-size:12px;color:var(--muted)}
.mini-controls{display:flex;gap:8px;align-items:center}
.mini-controls .btn{padding:8px}
@media(max-width:900px){.app{flex-direction:column;padding:12px}.search input{width:140px}}
.form-row{display:flex;gap:8px;align-items:center}
.form-row input{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
.small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="app">
    <div class="left">
      <div class="cover" id="cover">
        <img id="coverImg" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='%230b0f13'/><text x='50%' y='50%' font-size='46' fill='%231db954' dominant-baseline='middle' text-anchor='middle'>Siva Manihandan</text></svg>" alt="cover">
      </div>

      <div class="meta">
        <div class="title" id="trackTitle">No track loaded</div>
        <div class="artist">Siva Manihandan</div>
      </div>

      <div class="controls">
        <button class="btn" id="prevBtn" title="Previous">‚èÆ</button>
        <button class="btn play" id="playBtn" title="Play/Pause">‚ñ∂</button>
        <button class="btn" id="nextBtn" title="Next">‚è≠</button>
        <div style="flex:1"></div>
        <div class="chip" id="count">0 tracks</div>
      </div>

      <div class="progress">
        <input type="range" id="seek" min="0" max="100" value="0">
        <div class="time-row"><span id="curTime">0:00</span><span id="durTime">0:00</span></div>
      </div>

      <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
        <div class="form-row">
          <input id="ghOwner" placeholder="GitHub owner (e.g. your-username)" />
          <input id="ghRepo" placeholder="Repo (e.g. your-repo)" />
        </div>
        <div class="form-row">
          <input id="ghPath" placeholder="Folder path in repo (leave blank for root /)" style="flex:1" />
          <button class="btn" id="loadGh">Load from GitHub</button>
        </div>
        <div class="small">Tip: for GitHub Pages, put this index.html in the repo and set owner/repo above; if mp3s are in same folder, leave path blank.</div>

        <div style="margin-top:8px" class="bottom-bar">
          <label class="btn" for="dirPicker">Choose folder (local)</label>
          <input type="file" id="dirPicker" webkitdirectory directory multiple style="display:none">
          <div style="flex:1"></div>
          <div class="chip">Volume <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9" style="width:110px;margin-left:8px"></div>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="toolbar">
        <div class="search">üîé<input id="filter" placeholder="Search tracks..."></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="shuffleBtn" title="Shuffle">üîÄ</button>
          <button class="btn" id="repeatBtn" title="Repeat">üîÅ</button>
        </div>
      </div>

      <div class="playlist" id="playlist"></div>
    </div>
  </div>

  <div class="mini-player" id="miniPlayer" title="Click to open player">
    <div class="mini-cover"><img id="miniCoverImg" src="" alt="cover" style="width:52px;height:52px;object-fit:cover"></div>
    <div class="mini-info">
      <div class="mini-title" id="miniTitle">No track</div>
      <div class="mini-artist">Siva Manihandan</div>
    </div>
    <div class="mini-controls">
      <button class="btn" id="miniPrev">‚èÆ</button>
      <button class="btn play" id="miniPlay">‚ñ∂</button>
      <button class="btn" id="miniNext">‚è≠</button>
    </div>
  </div>

  <audio id="player" preload="metadata"></audio>

<script>
/* Dark MP3 player ‚Äî supports GitHub public repo folder load + local folder */
const DEFAULT_ARTIST = 'Siva Manihandan';
const AUDIO_RE = /\.(mp3|m4a|wav|ogg|flac)$/i;

const player = document.getElementById('player');
const playlistEl = document.getElementById('playlist');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const seek = document.getElementById('seek');
const curTime = document.getElementById('curTime');
const durTime = document.getElementById('durTime');
const countEl = document.getElementById('count');
const dirPicker = document.getElementById('dirPicker');
const filterInput = document.getElementById('filter');
const titleEl = document.getElementById('trackTitle');
const vol = document.getElementById('vol');
const shuffleBtn = document.getElementById('shuffleBtn');
const repeatBtn = document.getElementById('repeatBtn');
const mini = document.getElementById('miniPlayer');
const miniTitle = document.getElementById('miniTitle');
const miniPlay = document.getElementById('miniPlay');
const miniPrev = document.getElementById('miniPrev');
const miniNext = document.getElementById('miniNext');
const miniCoverImg = document.getElementById('miniCoverImg');

const ghOwner = document.getElementById('ghOwner');
const ghRepo = document.getElementById('ghRepo');
const ghPath = document.getElementById('ghPath');
const loadGhBtn = document.getElementById('loadGh');

let tracks = []; // {name, url, artist, source, _blob}
let current = 0;
let isShuffle = false;
let isRepeat = false;

vol.addEventListener('input', ()=> player.volume = vol.value);
player.volume = vol.value;

function fmtTime(s){ if(isNaN(s)) return '0:00'; const m=Math.floor(s/60); const sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }

function escapeHtml(s){ return String(s).replace(/[&<>"'`]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[c])); }

function render(filter=''){
  playlistEl.innerHTML = '';
  const list = tracks.filter(t => (t.name + ' ' + t.artist).toLowerCase().includes(filter.toLowerCase()));
  list.forEach(t => {
    const i = tracks.indexOf(t);
    const row = document.createElement('div');
    row.className = 'track' + (i===current ? ' active' : '');
    row.dataset.index = i;
    row.innerHTML = `<div class="num">${i+1}</div>
      <div><div class="name">${escapeHtml(t.name)}</div><div class="sub">${escapeHtml(t.artist)}</div></div>
      <div style="text-align:right;color:var(--muted)">${t.source||''}</div>`;
    row.addEventListener('click', ()=> playIndex(i));
    playlistEl.appendChild(row);
  });
  countEl.textContent = tracks.length + ' tracks';
  updateMini();
}

function updateMini(){
  const t = tracks[current];
  miniTitle.textContent = t ? t.name : 'No track';
  miniCoverImg.src = document.getElementById('coverImg').src;
  miniPlay.textContent = player.paused ? '‚ñ∂' : '‚è∏';
}

function setMeta(t){
  titleEl.textContent = t ? t.name : 'No track';
  if('mediaSession' in navigator && t){
    try{
      navigator.mediaSession.metadata = new MediaMetadata({
        title: t.name,
        artist: t.artist || DEFAULT_ARTIST,
        album: 'Local Folder',
        artwork: [{src: document.getElementById('coverImg').src, sizes:'512x512', type:'image/png'}]
      });
    }catch(e){}
  }
}

function playIndex(i){
  if(i<0 || i>=tracks.length) return;
  current = i;
  player.src = tracks[current].url;
  setMeta(tracks[current]);
  player.play().catch(()=>{ /* autoplay may be blocked until gesture */ });
  playBtn.textContent = '‚è∏';
  miniPlay.textContent = '‚è∏';
  render(filterInput.value);
  updateMini();
}

function playNext(){
  if(isRepeat){ player.currentTime = 0; player.play(); return; }
  if(isShuffle){ const n = Math.floor(Math.random()*tracks.length); playIndex(n); return; }
  if(current < tracks.length - 1) playIndex(current+1);
  else playIndex(0); // loop
}

function playPrev(){
  if(player.currentTime > 3){ player.currentTime = 0; player.play(); return; }
  if(current > 0) playIndex(current-1); else playIndex(0);
}

player.addEventListener('ended', ()=> playNext());
player.addEventListener('timeupdate', ()=> {
  if(player.duration){
    seek.value = (player.currentTime / player.duration) * 100;
    curTime.textContent = fmtTime(player.currentTime);
    durTime.textContent = fmtTime(player.duration);
  }
});
seek.addEventListener('input', ()=> { if(player.duration) player.currentTime = (seek.value/100) * player.duration; });

playBtn.addEventListener('click', ()=> {
  if(!player.src && tracks.length) playIndex(0);
  else if(player.paused){ player.play(); playBtn.textContent='‚è∏'; miniPlay.textContent='‚è∏'; }
  else { player.pause(); playBtn.textContent='‚ñ∂'; miniPlay.textContent='‚ñ∂'; }
});
prevBtn.addEventListener('click', playPrev);
nextBtn.addEventListener('click', ()=> { if(current < tracks.length -1) playIndex(current+1); else playIndex(0); });

mini.addEventListener('click', ()=> document.body.classList.toggle('show-full'));
miniPrev.addEventListener('click', e=>{ e.stopPropagation(); playPrev(); });
miniNext.addEventListener('click', e=>{ e.stopPropagation(); playNext(); });
miniPlay.addEventListener('click', e=>{ e.stopPropagation(); playBtn.click(); });

shuffleBtn.addEventListener('click', ()=> { isShuffle = !isShuffle; shuffleBtn.classList.toggle('active', isShuffle); });
repeatBtn.addEventListener('click', ()=> { isRepeat = !isRepeat; repeatBtn.classList.toggle('active', isRepeat); });

filterInput.addEventListener('input', ()=> render(filterInput.value));

// Local folder choose / drag & drop
dirPicker.addEventListener('change', e => {
  const files = Array.from(e.target.files || []);
  loadLocalFiles(files);
});
window.addEventListener('dragover', e=> e.preventDefault());
window.addEventListener('drop', e=> { e.preventDefault(); const files = Array.from((e.dataTransfer && e.dataTransfer.files) || []); loadLocalFiles(files); });

function loadLocalFiles(files){
  const audio = files.filter(f => AUDIO_RE.test(f.name));
  audio.sort((a,b)=> a.name.localeCompare(b.name, undefined, {numeric:true}));
  // revoke previous blob urls
  tracks.forEach(t=>{ if(t._blob) URL.revokeObjectURL(t.url); });
  tracks = audio.map(f => ({ name: f.name.replace(AUDIO_RE,''), url: URL.createObjectURL(f), artist: DEFAULT_ARTIST, source: 'local', _blob: true }));
  render('');
  if(tracks.length) playIndex(0);
}

// GitHub loading (public repo)
async function loadFromGitHub(owner, repo, path=''){
  // normalize
  owner = owner.trim(); repo = repo.trim(); path = path.trim();
  if(!owner || !repo) { alert('Enter GitHub owner and repo'); return; }
  // try GitHub Contents API: GET /repos/{owner}/{repo}/contents/{path}
  const api = `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/contents/${encodeURIComponent(path)}`;
  try{
    const resp = await fetch(api);
    if(!resp.ok){ throw new Error('GitHub API error: ' + resp.status); }
    const json = await resp.json();
    // json may be an array (folder) or an object (single file)
    let files = Array.isArray(json) ? json : [json];
    // filter mp3s and build tracks using download_url
    const audioFiles = files.filter(f => f && f.name && AUDIO_RE.test(f.name) && f.download_url);
    // sort by name
    audioFiles.sort((a,b)=> a.name.localeCompare(b.name, undefined, {numeric:true}));
    tracks = audioFiles.map(f => ({ name: f.name.replace(AUDIO_RE,''), url: f.download_url, artist: DEFAULT_ARTIST, source: 'github' }));
    render('');
    if(tracks.length) playIndex(0);
    else alert('No audio files found in that repo/path.');
  }catch(err){
    console.error(err);
    alert('Failed to load from GitHub: ' + err.message + '\nMake sure the repo is public and owner/repo/path are correct.');
  }
}

loadGhBtn.addEventListener('click', ()=> loadFromGitHub(ghOwner.value, ghRepo.value, ghPath.value));

// Try auto-detect when hosted on GitHub Pages (best-effort):
// If the page is loaded from github.io, attempt to infer owner/repo from hostname or meta and load files automatically.
window.addEventListener('load', ()=>{
  // If served via github pages domain like user.github.io or repo.github.io
  const host = location.hostname;
  // pattern: owner.github.io  or owner.github.io (user/organization site) OR owner.github.io/repo (project site)
  if(host.endsWith('github.io')){
    // try to parse owner/repo from pathname if possible
    // pathname like /repo/ or / (user site). If user site, repo is owner.github.io and files are in root.
    // We cannot reliably infer repo for user pages; keep it manual but offer auto for common case: owner.github.io/repo
    const parts = location.pathname.replace(/^\/|\/$/g,'').split('/');
    if(parts.length >= 1 && parts[0]){
      // prompt-less: do nothing automatically; user can press Load from GitHub which is simple and safe.
      console.info('Hosting on GitHub Pages detected ‚Äî use the "Load from GitHub" inputs to point to repo/folder.');
    }
  }
});

// Media Session handlers for lock-screen controls
if('mediaSession' in navigator){
  navigator.mediaSession.setActionHandler('play', ()=>{ player.play(); playBtn.textContent='‚è∏'; miniPlay.textContent='‚è∏'; });
  navigator.mediaSession.setActionHandler('pause', ()=>{ player.pause(); playBtn.textContent='‚ñ∂'; miniPlay.textContent='‚ñ∂'; });
  navigator.mediaSession.setActionHandler('previoustrack', ()=>{ playPrev(); });
  navigator.mediaSession.setActionHandler('nexttrack', ()=>{ playNext(); });
}

// Keyboard shortcuts
window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); playBtn.click(); } if(e.code==='ArrowRight') nextBtn.click(); if(e.code==='ArrowLeft') prevBtn.click(); });
</script>
</body>
</html>
