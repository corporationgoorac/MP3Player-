<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<!-- Disable pinch/zoom on mobile -->
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>MP3 Player — Professional</title>
<meta name="description" content="Professional dark MP3 player — clean UI, no zooming">
<link rel="icon" href="data:," />
<style>
/* Professional, restrained UI — subtle glass, refined spacing */
:root{
  --bg-900:#051018;
  --bg-700:#07161a;
  --panel:#0e2224;
  --muted:#9fb0b6;
  --accent:#1db954;
  --glass: rgba(255,255,255,0.025);
  --card: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.007));
  --text:#e7f2f5;
  --radius:14px;
  --gap:18px;
  --shadow: 0 18px 60px rgba(0,0,0,0.6);
  font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  font-size:15px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-900),var(--bg-700));color:var(--text);overflow:auto}
.container{display:grid;grid-template-columns:420px 1fr;gap:var(--gap);height:100vh;padding:28px}

/* LEFT: Player card */
.player-card{
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  display:flex;
  flex-direction:column;
  gap:18px;
  box-shadow:var(--shadow);
  min-height:0;
  border:1px solid rgba(255,255,255,0.02);
}
.cover{
  height:360px;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,#052826,#082022);border:1px solid rgba(255,255,255,0.02);
  transition:transform .35s cubic-bezier(.2,.9,.25,1);
}
.cover:hover{ transform:translateY(-4px); }
.cover img{width:100%;height:100%;object-fit:cover;display:block}

/* Meta */
.meta{display:flex;flex-direction:column;gap:6px}
.title{font-weight:800;font-size:20px;letter-spacing:0.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.artist{color:var(--muted);font-size:13px}

/* Controls row */
.controls{display:flex;align-items:center;gap:12px}
.icon-btn{
  background:transparent;border:0;color:var(--text);padding:10px;border-radius:10px;cursor:pointer;font-size:18px;
  transition:background .12s, transform .08s;
}
.icon-btn:hover{ background:rgba(255,255,255,0.02); transform:translateY(-2px); }
.play-btn{
  width:70px;height:70px;border-radius:14px;border:0;background:linear-gradient(180deg,var(--accent),#16a84a);color:#02140a;font-weight:900;font-size:20px;
  display:inline-flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 14px 40px rgba(29,185,84,0.12);
}
.seek{margin-top:6px}
input[type=range]{width:100%;height:6px;background:transparent;-webkit-appearance:none}
input[type=range]::-webkit-slider-runnable-track{height:6px;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));border-radius:6px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;margin-top:-5px;width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 6px 12px rgba(0,0,0,0.4);cursor:pointer}
.time-row{display:flex;justify-content:space-between;color:var(--muted);font-size:13px}

/* settings row */
.settings{display:flex;align-items:center;gap:10px;margin-top:6px}
.pill{background:var(--glass);padding:8px 12px;border-radius:999px;color:var(--muted);font-size:13px;display:inline-flex;align-items:center;gap:8px}

/* RIGHT: Playlist */
.playlist-panel{display:flex;flex-direction:column;gap:12px;min-height:0}
.toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
.search{
  flex:1;background:transparent;border:1px solid rgba(255,255,255,0.02);padding:10px;border-radius:10px;display:flex;gap:8px;align-items:center;
  transition:border-color .12s;
}
.search input{background:transparent;border:0;color:var(--text);outline:0;width:100%;font-size:14px}
.search:focus-within{border-color:rgba(255,255,255,0.04)}
.import-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;color:var(--text);cursor:pointer}

/* playlist list */
.playlist{
  background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  border-radius:12px;padding:12px;overflow:auto;flex:1;box-shadow:inset 0 -30px 60px rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.02);
}
.track-row{
  display:grid;grid-template-columns:40px 1fr 92px;gap:12px;align-items:center;padding:10px;border-radius:10px;border:1px solid transparent;cursor:pointer;
}
.track-row + .track-row{margin-top:8px}
.track-row:hover{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.02);transform:translateY(-2px);transition:transform .12s, background .12s}
.track-row.active{background:linear-gradient(90deg, rgba(29,185,84,0.06), rgba(29,185,84,0.02));border-color:rgba(29,185,84,0.06)}
.track-index{color:var(--muted);font-weight:700;text-align:center}
.track-thumb{width:48px;height:48px;border-radius:8px;overflow:hidden}
.track-title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.track-sub{font-size:13px;color:var(--muted);margin-top:6px}
.track-duration{text-align:right;color:var(--muted);font-size:13px}

/* mini player */
.mini{
  position:fixed;left:20px;right:20px;bottom:20px;height:64px;background:linear-gradient(180deg,#071316,#071316);border-radius:12px;padding:10px;display:flex;align-items:center;gap:12px;box-shadow:0 18px 60px rgba(0,0,0,0.6);
  transition:transform .18s;
}
.mini .thumb{width:52px;height:52px;border-radius:8px;overflow:hidden}
.mini .meta{flex:1;min-width:0}
.mini .title{font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.mini .artist{font-size:12px;color:var(--muted)}

/* focus-visible for accessibility */
.icon-btn:focus, .play-btn:focus, .import-btn:focus, .search input:focus { outline: 3px solid rgba(29,185,84,0.12); outline-offset:2px; border-radius:8px; }

/* responsive */
@media (max-width:980px){
  .container{grid-template-columns:1fr;padding:14px}
  .cover{height:220px}
  .player-card{padding:14px}
}
</style>
</head>
<body>
  <div class="container">
    <div class="player-card" role="region" aria-label="Player">
      <div class="cover" id="cover"><img id="coverImg" alt="Cover"></div>

      <div class="meta">
        <div class="title" id="trackTitle">Loading…</div>
        <div class="artist" id="trackArtist">Siva Manihandan</div>
      </div>

      <div class="controls" role="group" aria-label="Playback controls">
        <button class="icon-btn" id="prevBtn" title="Previous">⏮</button>
        <button class="play-btn" id="playBtn" aria-pressed="false" title="Play">▶</button>
        <button class="icon-btn" id="nextBtn" title="Next">⏭</button>
        <div style="flex:1"></div>
        <div class="pill" id="count">0</div>
      </div>

      <div class="seek">
        <input type="range" id="seek" min="0" max="100" value="0" aria-label="Seek">
        <div class="time-row"><span id="curTime">0:00</span><span id="durTime">0:00</span></div>
      </div>

      <div class="settings">
        <div class="pill"><label style="cursor:pointer"><input id="shuffle" type="checkbox" style="margin-right:8px">Shuffle</label></div>
        <div class="pill"><label style="cursor:pointer"><input id="repeat" type="checkbox" style="margin-right:8px">Repeat</label></div>
        <div style="flex:1"></div>
        <div class="pill" id="autoplayChip">Autoplay</div>
      </div>
    </div>

    <div class="playlist-panel" role="region" aria-label="Playlist">
      <div class="toolbar">
        <div class="search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.9"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg><input id="filter" placeholder="Search songs..." aria-label="Search songs"></div>
        <button id="import" class="import-btn" title="Import local mp3">Import</button>
      </div>

      <div class="playlist" id="playlist" role="list"></div>
    </div>
  </div>

  <div class="mini" id="mini" style="display:none" role="status" aria-live="polite">
    <div class="thumb" id="miniThumb"><img id="miniImg" style="width:100%;height:100%;object-fit:cover" alt=""></div>
    <div class="meta">
      <div class="title" id="miniTitle">No track</div>
      <div class="artist" id="miniArtist">Siva Manihandan</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="icon-btn" id="miniPrev" title="Previous">⏮</button>
      <button class="play-btn" id="miniPlay" style="width:44px;height:44px;font-size:16px">▶</button>
      <button class="icon-btn" id="miniNext" title="Next">⏭</button>
    </div>
  </div>

  <audio id="player" preload="metadata"></audio>

<script>
/* Professional player script (no-zoom protections included)
   Auto-loads .mp3 from corporationgoorac/MP3Player- (branch main)
*/

const OWNER = 'corporationgoorac';
const REPO  = 'MP3Player-';
const BRANCH = 'main';
const AUDIO_RE = /\.mp3(\?.*)?$/i;
const DEFAULT_ARTIST = 'Siva Manihandan';

const player = document.getElementById('player');
const playlistEl = document.getElementById('playlist');
const coverImg = document.getElementById('coverImg');
const titleEl = document.getElementById('trackTitle');
const artistEl = document.getElementById('trackArtist');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const seek = document.getElementById('seek');
const curTime = document.getElementById('curTime');
const durTime = document.getElementById('durTime');
const countEl = document.getElementById('count');
const filterInput = document.getElementById('filter');
const importBtn = document.getElementById('import');
const shuffleEl = document.getElementById('shuffle');
const repeatEl = document.getElementById('repeat');
const autoplayChip = document.getElementById('autoplayChip');
const mini = document.getElementById('mini');
const miniImg = document.getElementById('miniImg');
const miniTitle = document.getElementById('miniTitle');
const miniArtist = document.getElementById('miniArtist');
const miniPlay = document.getElementById('miniPlay');
const miniPrev = document.getElementById('miniPrev');
const miniNext = document.getElementById('miniNext');

let tracks = []; // {name,url,artist,thumb,duration,_blob}
let current = 0;
let isShuffle = false, isRepeat = false, autoplay = true;
player.volume = 1;

// small util functions
function esc(s){ return String(s || '').replace(/[&<>"'`]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[c])); }
function hashCode(s){ let h=0; for(let i=0;i<s.length;i++){ h=((h<<5)-h)+s.charCodeAt(i); h|=0; } return h; }
function fmtTime(s){ if(isNaN(s)||!isFinite(s)) return '0:00'; const m=Math.floor(s/60); const ss=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }

// cover/thumb generators
function makeThumb(name){
  const initials = (name||'').split(/[\s\-_]+/).map(t=>t[0]||'').slice(0,2).join('').toUpperCase() || 'S';
  const palette = ['#1db954','#6b8bff','#ff7a7a','#9b6bff','#f5b142'];
  const c = palette[Math.abs(hashCode(name||'')) % palette.length];
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect width='100%' height='100%' fill='${c}'/><text x='50%' y='56%' font-size='140' text-anchor='middle' fill='rgba(255,255,255,0.95)' font-family='Inter,Arial' font-weight='800'>${esc(initials)}</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}
function makeCover(name){
  const letter = String((name||'').trim()[0] || 'S').toUpperCase();
  const seed = Math.abs(hashCode(name||'')) % 360;
  const c1 = `hsl(${seed} 56% 35%)`, c2 = `hsl(${(seed+28)%360} 50% 22%)`;
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='1024'><defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='${c1}'/><stop offset='1' stop-color='${c2}'/></linearGradient></defs><rect width='100%' height='100%' fill='url(#g)'/><text x='50%' y='60%' font-size='520' text-anchor='middle' fill='rgba(255,255,255,0.94)' font-family='Inter,Arial' font-weight='900'>${esc(letter)}</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

// render playlist
function render(filter=''){
  playlistEl.innerHTML = '';
  const filtered = tracks.filter(t => (t.name + ' ' + (t.artist||'')).toLowerCase().includes(filter.toLowerCase()));
  filtered.forEach((t, idx) => {
    const i = tracks.indexOf(t);
    const row = document.createElement('div');
    row.className = 'track-row' + (i === current ? ' active' : '');
    row.dataset.index = i;
    row.innerHTML = `
      <div class="track-index">${String(i+1).padStart(2,'0')}</div>
      <div>
        <div class="track-title">${esc(t.name)}</div>
        <div class="track-sub">${esc(t.artist || DEFAULT_ARTIST)}</div>
      </div>
      <div class="track-duration">${t.duration ? fmtTime(t.duration) : ''}</div>
    `;
    row.addEventListener('click', ()=> playIndex(i));
    playlistEl.appendChild(row);
  });
  countEl.textContent = tracks.length;
  updateMini();
}

// set current metadata
function setMeta(t){
  titleEl.textContent = t ? t.name : 'No track';
  artistEl.textContent = t ? (t.artist || DEFAULT_ARTIST) : DEFAULT_ARTIST;
  coverImg.src = t ? makeCover(t.name) : '';
  if('mediaSession' in navigator && t){
    try{
      navigator.mediaSession.metadata = new MediaMetadata({ title: t.name, artist: t.artist || DEFAULT_ARTIST, album: 'Local', artwork:[{src:t.thumb,sizes:'512x512'}]});
    }catch(e){}
  }
}

// playback functions
function playIndex(i){
  if(tracks.length === 0) return;
  if(i < 0) i = 0;
  if(i >= tracks.length) i = 0;
  current = i;
  const t = tracks[current];
  player.src = t.url;
  setMeta(t);
  player.play().catch(()=>{});
  render(filterInput.value);
}
function playNext(){
  if(isRepeat){ player.currentTime = 0; player.play(); return; }
  if(isShuffle){ playIndex(Math.floor(Math.random()*tracks.length)); return; }
  playIndex((current + 1) % tracks.length);
}
function playPrev(){
  if(player.currentTime > 3){ player.currentTime = 0; player.play(); return; }
  playIndex(Math.max(0, current - 1));
}

// audio events
player.addEventListener('timeupdate', ()=> {
  if(player.duration){
    seek.value = (player.currentTime / player.duration) * 100;
    curTime.textContent = fmtTime(player.currentTime);
    durTime.textContent = fmtTime(player.duration);
  }
});
player.addEventListener('loadedmetadata', ()=> {
  if(player.duration && tracks[current]){ tracks[current].duration = player.duration; render(filterInput.value); }
});
player.addEventListener('ended', ()=> { if(autoplay) playNext(); else { playBtn.textContent='▶'; miniPlay.textContent='▶'; } });
seek.addEventListener('input', ()=> { if(player.duration) player.currentTime = (seek.value/100) * player.duration; });

// UI handlers
playBtn.addEventListener('click', ()=>{
  if(!player.src && tracks.length){ playIndex(0); return; }
  if(player.paused){ player.play(); playBtn.textContent='⏸'; miniPlay.textContent='⏸'; }
  else { player.pause(); playBtn.textContent='▶'; miniPlay.textContent='▶'; }
});
prevBtn.addEventListener('click', playPrev);
nextBtn.addEventListener('click', playNext);
miniPrev.addEventListener('click', e=>{ e.stopPropagation(); playPrev(); });
miniNext.addEventListener('click', e=>{ e.stopPropagation(); playNext(); });
miniPlay.addEventListener('click', e=>{ e.stopPropagation(); playBtn.click(); });

shuffleEl.addEventListener('change', ()=> isShuffle = shuffleEl.checked);
repeatEl.addEventListener('change', ()=> isRepeat = repeatEl.checked);

// mini update
function updateMini(){
  const t = tracks[current];
  if(!t){ mini.style.display = 'none'; return; }
  mini.style.display = 'flex';
  miniTitle.textContent = t.name;
  miniArtist.textContent = t.artist || DEFAULT_ARTIST;
  miniImg.src = t.thumb;
  const paused = player.paused || !player.src;
  miniPlay.textContent = paused ? '▶' : '⏸';
  playBtn.textContent = paused ? '▶' : '⏸';
}

// keyboard shortcuts
document.addEventListener('keydown', e=> { const tag=document.activeElement&&document.activeElement.tagName.toLowerCase(); if(tag==='input'||tag==='textarea') return; if(e.code==='Space'){ e.preventDefault(); playBtn.click(); } if(e.code==='ArrowRight') nextBtn.click(); if(e.code==='ArrowLeft') prevBtn.click(); });

// import local files
importBtn.addEventListener('click', ()=> {
  const inp = document.createElement('input'); inp.type='file'; inp.multiple=true; inp.accept='.mp3';
  inp.onchange = async ()=> {
    if(!inp.files) return;
    const files = Array.from(inp.files).filter(f => AUDIO_RE.test(f.name));
    if(!files.length) return;
    tracks.forEach(t=> { if(t._blob) URL.revokeObjectURL(t.url); });
    tracks = files.map(f => ({ name: f.name.replace(/\.[^/.]+$/,''), url: URL.createObjectURL(f), artist: DEFAULT_ARTIST, _blob:true, thumb: makeThumb(f.name.replace(/\.[^/.]+$/,'')) }));
    await populateDurations();
    render(''); if(tracks.length) playIndex(0);
  };
  inp.click();
});

// durations helper
async function populateDurations(){
  const promises = tracks.map(t => new Promise(resolve => {
    if(t.duration && !isNaN(t.duration)) return resolve(t);
    const a = document.createElement('audio'); a.preload='metadata'; a.src = t.url;
    const tidy = ()=> { try{ a.remove(); }catch(e){} };
    const onmeta = ()=> { if(!isNaN(a.duration) && isFinite(a.duration)) t.duration = a.duration; tidy(); resolve(t); };
    const onerr = ()=> { tidy(); resolve(t); };
    a.addEventListener('loadedmetadata', onmeta, {once:true}); a.addEventListener('error', onerr, {once:true}); a.load();
    setTimeout(()=> { resolve(t); try{ a.remove(); }catch(e){} }, 6000);
  }));
  await Promise.all(promises);
}

// Auto-load GitHub repo root
async function loadFromGithub(){
  try{
    const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/?ref=${BRANCH}`;
    const res = await fetch(api, { headers: { 'Accept': 'application/vnd.github.v3+json' }});
    if(!res.ok){ console.error('GitHub API error', res.status, await res.text()); titleEl.textContent = 'No tracks found'; return; }
    const json = await res.json();
    if(!Array.isArray(json)){ titleEl.textContent = 'No tracks found'; console.log(json); return; }
    const mp3items = json.filter(i => i.type === 'file' && AUDIO_RE.test(i.name));
    if(mp3items.length === 0){ titleEl.textContent = 'No tracks found'; return; }
    tracks = mp3items.map(item => ({ name: item.name.replace(/\.[^/.]+$/,''), url: item.download_url, artist: DEFAULT_ARTIST, thumb: makeThumb(item.name) }));
    await populateDurations();
    render('');
    if(tracks.length) playIndex(0);
  }catch(e){ console.error(e); titleEl.textContent = 'Load error'; }
}

// Start on load
window.addEventListener('load', async ()=> {
  autoplay = true; autoplayChip.textContent = 'Autoplay';
  await loadFromGithub();
  updateMini();
});

// cleanup blob URLs
window.addEventListener('beforeunload', ()=> { tracks.forEach(t=> { if(t._blob) URL.revokeObjectURL(t.url); }); });

/* ---------- NO-ZOOM / anti-zoom measures ----------
   The following reduce accidental zooming:
   - meta viewport set with user-scalable=no
   - block wheel+ctrl (desktop zoom)
   - block key combos: Ctrl/Cmd + '+' , '-' , '0'
   - block gesturestart (iOS) to prevent pinch-zoom
   Note: browser-level zoom can still be forced by user settings; this prevents common zoom gestures.
*/
(function preventZoom(){
  // block ctrl/cmd + wheel
  window.addEventListener('wheel', function(e){
    if(e.ctrlKey || e.metaKey){
      e.preventDefault();
    }
  }, { passive:false });

  // block ctrl/cmd +/-/0 zoom keys
  window.addEventListener('keydown', function(e){
    const z = (e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key ===
