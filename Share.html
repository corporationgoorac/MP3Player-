<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Now Playing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    margin:0;
    background:#121212;
    color:#fff;
    font-family:system-ui,-apple-system;
}

.app{
    max-width:420px;
    margin:auto;
    padding:20px;
}

.cover{
    width:100%;
    aspect-ratio:1/1;
    border-radius:14px;
    background:linear-gradient(135deg,#1db954,#0f9d58);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:96px;
    font-weight:700;
}

.title{
    margin-top:20px;
    font-size:22px;
    font-weight:600;
}

.artist{
    color:#b3b3b3;
    margin-top:4px;
}

.row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:16px;
}

.actions span{
    font-size:22px;
    cursor:pointer;
}

.plays{
    color:#b3b3b3;
    font-size:14px;
}

.progress{
    width:100%;
    margin-top:18px;
}

.play-wrap{
    display:flex;
    justify-content:center;
    margin-top:24px;
}

.play-btn{
    width:64px;
    height:64px;
    border-radius:50%;
    background:#1db954;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:26px;
    color:#000;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="app">
    <div class="cover" id="cover">?</div>

    <div class="title" id="title">Loading‚Ä¶</div>
    <div class="artist">sivamanihandan</div>

    <div class="row">
        <div class="actions">
            <span id="like">ü§ç</span>
            <span id="share" style="margin-left:16px">üîó</span>
        </div>
        <div class="plays" id="plays"></div>
    </div>

    <input type="range" id="progress" class="progress" value="0">

    <div class="play-wrap">
        <div class="play-btn" id="play">‚ñ∂</div>
    </div>
</div>

<audio id="audio" preload="metadata"></audio>

<script>
// ================== CONFIG (CHANGE THIS) ==================
const GITHUB_USER = "USERNAME";        // e.g. sivamanihandan
const REPO_NAME   = "REPO";            // repo name
const BRANCH      = "main";            // usually main
const SONGS_PATH  = "songs";           // folder name
// ==========================================================

// ---------- URL SONG ----------
const params = new URLSearchParams(location.search);
const requestedSong = params.get("song")?.toLowerCase();

// ---------- ELEMENTS ----------
const audio = document.getElementById("audio");
const playBtn = document.getElementById("play");
const progress = document.getElementById("progress");
const title = document.getElementById("title");
const cover = document.getElementById("cover");
const like = document.getElementById("like");
const share = document.getElementById("share");
const plays = document.getElementById("plays");

let liked = false;

// ---------- FAKE STATS ----------
function fake(min,max){
    return Math.floor(Math.random()*(max-min)+min);
}

// ---------- FETCH SONGS FROM GITHUB ----------
async function loadSongFromGitHub(){
    if(!requestedSong){
        title.textContent = "No song in URL";
        return;
    }

    const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/contents/${SONGS_PATH}?ref=${BRANCH}`;

    const res = await fetch(apiUrl);
    const files = await res.json();

    const match = files.find(f =>
        f.name.toLowerCase() === requestedSong &&
        f.name.toLowerCase().endsWith(".mp3")
    );

    if(!match){
        title.textContent = "Song not found";
        return;
    }

    const realName = match.name;
    const displayName = realName.replace(".mp3","");

    title.textContent = displayName;
    cover.textContent = displayName.charAt(0).toUpperCase();
    plays.textContent = fake(10000,1000000).toLocaleString()+" plays";

    audio.src = match.download_url;
}

loadSongFromGitHub();

// ---------- PLAY / PAUSE ----------
playBtn.onclick = async ()=>{
    if(!audio.src) return;
    if(audio.paused){
        await audio.play();
        playBtn.textContent="‚è∏";
    }else{
        audio.pause();
        playBtn.textContent="‚ñ∂";
    }
};

// ---------- PROGRESS ----------
audio.ontimeupdate = ()=>{
    progress.max = audio.duration || 0;
    progress.value = audio.currentTime || 0;
};

progress.oninput = ()=>{
    audio.currentTime = progress.value;
};

// ---------- LIKE ----------
like.onclick = ()=>{
    liked = !liked;
    like.textContent = liked ? "‚ù§Ô∏è" : "ü§ç";
};

// ---------- SHARE ----------
share.onclick = ()=>{
    navigator.clipboard.writeText(location.href);
    alert("Song link copied!");
};
</script>

</body>
</html>
