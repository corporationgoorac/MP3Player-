<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Now Playing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
    --green:#1db954;
    --bg:#121212;
    --card:#181818;
    --text:#ffffff;
    --muted:#b3b3b3;
}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,BlinkMacSystemFont;
}

.app{
    max-width:420px;
    margin:auto;
    padding:20px;
}

.cover{
    width:100%;
    aspect-ratio:1/1;
    border-radius:16px;
    background:linear-gradient(135deg,#1db954,#0f9d58);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:96px;
    font-weight:800;
    letter-spacing:2px;
}

.title{
    margin-top:20px;
    font-size:24px;
    font-weight:700;
}

.artist{
    color:var(--muted);
    margin-top:4px;
    font-size:15px;
}

.meta{
    margin-top:10px;
    color:var(--muted);
    font-size:14px;
}

.actions{
    display:flex;
    align-items:center;
    gap:20px;
    margin-top:18px;
    font-size:22px;
}

.actions span{
    cursor:pointer;
}

.progress{
    width:100%;
    margin-top:22px;
}

.play-wrap{
    display:flex;
    justify-content:center;
    margin-top:26px;
}

.play-btn{
    width:68px;
    height:68px;
    border-radius:50%;
    background:var(--green);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    color:#000;
    cursor:pointer;
    box-shadow:0 8px 24px rgba(0,0,0,.4);
}
</style>
</head>

<body>

<div class="app">
    <div class="cover" id="cover">?</div>

    <div class="title" id="title">Loading‚Ä¶</div>
    <div class="artist" id="artist">sivamanihandan</div>

    <div class="meta" id="meta">‚Äî</div>

    <div class="actions">
        <span id="like">ü§ç</span>
        <span id="share">üîó</span>
    </div>

    <input type="range" id="progress" class="progress" value="0">

    <div class="play-wrap">
        <div class="play-btn" id="play">‚ñ∂</div>
    </div>
</div>

<audio id="audio" preload="metadata"></audio>

<script>
const params = new URLSearchParams(location.search);
const baseName = params.get("song");

const audio = document.getElementById("audio");
const title = document.getElementById("title");
const cover = document.getElementById("cover");
const playBtn = document.getElementById("play");
const progress = document.getElementById("progress");
const meta = document.getElementById("meta");
const likeBtn = document.getElementById("like");
const shareBtn = document.getElementById("share");

let liked = false;

async function tryLoad(name){
    return new Promise(resolve=>{
        const test = new Audio(name);
        test.oncanplaythrough = () => resolve(name);
        test.onerror = () => resolve(null);
    });
}

async function loadSong(){
    if(!baseName){
        title.textContent = "No song in URL";
        return;
    }

    const candidates = [
        `${baseName}.mp3`,
        `${baseName.charAt(0).toUpperCase()+baseName.slice(1)}.mp3`,
        `${baseName.toUpperCase()}.mp3`
    ];

    for(const file of candidates){
        const found = await tryLoad(file);
        if(found){
            audio.src = found;

            const cleanTitle = found.replace(".mp3","");
            title.textContent = cleanTitle;
            cover.textContent = cleanTitle[0].toUpperCase();

            audio.onloadedmetadata = () => {
                const duration = Math.floor(audio.duration);
                const likes = duration * 30;
                const plays = likes * 10;

                meta.textContent =
                    `${plays.toLocaleString()} plays ‚Ä¢ ${likes.toLocaleString()} likes`;
            };

            return;
        }
    }

    title.textContent = "Song not found";
}

loadSong();

// PLAY / PAUSE
playBtn.onclick = async ()=>{
    if(audio.paused){
        await audio.play();
        playBtn.textContent="‚è∏";
    }else{
        audio.pause();
        playBtn.textContent="‚ñ∂";
    }
};

// PROGRESS
audio.ontimeupdate = ()=>{
    progress.max = audio.duration || 0;
    progress.value = audio.currentTime || 0;
};

progress.oninput = ()=>{
    audio.currentTime = progress.value;
};

// LIKE
likeBtn.onclick = ()=>{
    liked = !liked;
    likeBtn.textContent = liked ? "‚ù§Ô∏è" : "ü§ç";
};

// SHARE
shareBtn.onclick = ()=>{
    navigator.clipboard.writeText(location.href);
    alert("Song link copied!");
};
</script>

</body>
</html>
