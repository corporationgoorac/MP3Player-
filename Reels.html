<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VoidUpLift Reels Editor Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Anton&family=Bebas+Neue&family=Playfair+Display&family=Oswald&family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
*{ box-sizing:border-box; margin:0; padding:0; }
body{ background:#000; color:#fff; font-family:'Poppins', sans-serif; height:100vh; overflow:hidden; }
.app{ display:flex; flex-direction:column; height:100vh; max-width:500px; margin:auto; border:1px solid #222; position:relative; }

.preview{ padding:10px; background:#111; text-align:center; }
canvas{ height:35vh; aspect-ratio:9/16; border-radius:12px; border:2px solid #333; background:#000; touch-action:none; }

.play-btn-ui{ font-size:36px; color:#00f2ea; cursor:pointer; }
#timeline{ width:90%; accent-color:#00f2ea; }

.iconbar{ display:flex; justify-content:space-around; padding:10px; background:#080808; border-top:1px solid #222; }
.iconbar span{ font-size:24px; color:#666; cursor:pointer; }
.iconbar span.active-tab{ color:#00f2ea; }

.controls{ flex:1; padding:15px; background:#080808; overflow-y:auto; }
.panel{ display:none; }
.panel.active{ display:block; }

label{ font-size:10px; color:#00f2ea; margin-bottom:4px; display:block; }
textarea,input,select{ width:100%; background:#151515; color:#fff; border:1px solid #333; padding:10px; margin-bottom:12px; border-radius:6px; }
input[type=range]{ accent-color:#00f2ea; }
input[type=color]{ height:35px; }

.status-bar{ text-align:center; font-size:11px; padding:8px; background:#050505; color:#00f2ea; }

#loadingOverlay{
    display:none; position:absolute; inset:0;
    background:rgba(0,0,0,.9);
    z-index:99; display:flex; flex-direction:column;
    align-items:center; justify-content:center;
}
</style>
</head>

<body>
<div class="app">

<div id="loadingOverlay">
    <div id="progressText" style="color:#00f2ea;font-size:18px;">Rendering 0%</div>
    <p style="color:#666;font-size:12px;">Exporting video...</p>
</div>

<div class="preview">
    <canvas id="canvas" width="1080" height="1920"></canvas>
    <div style="display:flex;justify-content:center;gap:10px;align-items:center;">
        <span id="playBtn" class="material-icons play-btn-ui">play_circle_filled</span>
        <input type="range" id="timeline" min="0" step="0.01" value="0">
    </div>
</div>

<div class="iconbar">
    <span class="material-icons active-tab" onclick="showPanel('textP',this)">text_fields</span>
    <span class="material-icons" onclick="showPanel('fontP',this)">font_download</span>
    <span class="material-icons" onclick="showPanel('imgP',this)">image</span>
    <span class="material-icons" onclick="showPanel('audioP',this)">music_note</span>
    <span class="material-icons" id="exportBtn" style="color:#00f2ea">download</span>
</div>

<div class="controls">
<div id="textP" class="panel active">
    <label>Text</label>
    <textarea id="textInput">VoidUpLift</textarea>

    <label>Font Size</label>
    <input type="range" id="fontSizeRange" min="30" max="300" value="100">

    <label>Color</label>
    <input type="color" id="textColorPicker" value="#ffffff">

    <label><input type="checkbox" id="typingToggle"> Typing Effect</label>
    <label>Typing Speed</label>
    <input type="range" id="typingSpeedRange" min="5" max="60" value="20">
</div>

<div id="fontP" class="panel">
    <label>Font</label>
    <select id="fontFamilySelect">
        <option>Poppins</option>
        <option>Anton</option>
        <option>Bebas Neue</option>
        <option>Oswald</option>
        <option>Pacifico</option>
    </select>

    <label>Animation</label>
    <select id="animSelect">
        <option value="fade">Fade</option>
        <option value="slide">Slide</option>
        <option value="pop">Pop</option>
        <option value="bounce">Bounce</option>
    </select>
</div>

<div id="imgP" class="panel">
    <label>Background Image</label>
    <input type="file" id="bgUpload" accept="image/*">

    <label>Duration (sec)</label>
    <input type="number" id="videoDuration" value="17">
</div>

<div id="audioP" class="panel">
    <label>Audio</label>
    <input type="file" id="audioUpload" accept="audio/*">
</div>
</div>

<div class="status-bar">Ready</div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let bgImg = new Image();
let textStr="VoidUpLift",font="Poppins",size=100,color="#fff";
let x=100,y=400,anim="fade",typing=false,speed=20;
let time=0,duration=17,playing=false,last=0;

function showPanel(id,el){
 document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
 document.querySelectorAll('.iconbar span').forEach(i=>i.classList.remove('active-tab'));
 document.getElementById(id).classList.add('active'); el.classList.add('active-tab');
}

textInput.oninput=e=>{textStr=e.target.value;draw()};
fontSizeRange.oninput=e=>{size=e.target.value;draw()};
textColorPicker.oninput=e=>{color=e.target.value;draw()};
fontFamilySelect.onchange=e=>{font=e.target.value;draw()};
animSelect.onchange=e=>{anim=e.target.value;draw()};
typingToggle.onchange=e=>{typing=e.target.checked;draw()};
typingSpeedRange.oninput=e=>{speed=e.target.value;draw()};
videoDuration.oninput=e=>{duration=+e.target.value;timeline.max=duration;draw()};
timeline.oninput=e=>{time=+e.target.value;draw()};
bgUpload.onchange=e=>{bgImg.src=URL.createObjectURL(e.target.files[0]);bgImg.onload=draw};

let drag=false;
canvas.onpointerdown=()=>drag=true;
window.onpointerup=()=>drag=false;
window.onpointermove=e=>{
 if(!drag)return;
 const r=canvas.getBoundingClientRect();
 x=(e.clientX-r.left)*1080/r.width;
 y=(e.clientY-r.top)*1920/r.height;
 draw();
};

function draw(){
 ctx.clearRect(0,0,1080,1920);
 ctx.fillStyle="#000";ctx.fillRect(0,0,1080,1920);
 if(bgImg.complete) {
  let s=Math.min(1080/bgImg.width,1920/bgImg.height);
  ctx.drawImage(bgImg,(1080-bgImg.width*s)/2,(1920-bgImg.height*s)/2,bgImg.width*s,bgImg.height*s);
 }
 ctx.fillStyle=color;
 ctx.font=size+"px "+font;
 ctx.shadowColor="rgba(0,0,0,.6)";
 ctx.shadowBlur=15;

 let p=Math.min(1,time/1.5);
 let dy=y,sc=1;
 if(anim==="slide")dy+=(1-p)*150;
 if(anim==="pop")sc=0.7+p*0.3;
 if(anim==="bounce")dy+=Math.sin(time*4)*-30;

 ctx.save();
 ctx.translate(x,dy);ctx.scale(sc,sc);
 let txt=typing?textStr.slice(0,Math.floor(time*speed)):textStr;
 ctx.fillText(txt,0,0);
 ctx.restore();
}

playBtn.onclick=()=>{
 playing=!playing;
 playBtn.textContent=playing?"pause_circle_filled":"play_circle_filled";
 if(playing){last=performance.now();requestAnimationFrame(loop);}
};

function loop(now){
 if(!playing)return;
 time+=(now-last)/1000;last=now;
 if(time>duration){time=0;playing=false;playBtn.textContent="play_circle_filled";}
 timeline.value=time;draw();requestAnimationFrame(loop);
}

/* ======= STABLE EXPORT ENGINE ======= */
exportBtn.onclick=()=>{
 const fps=30;
 loadingOverlay.style.display="flex";
 const stream=canvas.captureStream(fps);
 const rec=new MediaRecorder(stream,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:12000000});
 const chunks=[];
 rec.ondataavailable=e=>chunks.push(e.data);
 rec.onstop=()=>{
  const blob=new Blob(chunks,{type:"video/webm"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="VoidUpLift_Reel.webm";
  a.click();
  loadingOverlay.style.display="none";
 };
 rec.start();
 time=0;
 const start=performance.now();
 function render(now){
  time=(now-start)/1000;
  if(time>=duration){rec.stop();return;}
  draw();
  progressText.innerText=`Rendering ${Math.round(time/duration*100)}%`;
  requestAnimationFrame(render);
 }
 requestAnimationFrame(render);
};

draw();
</script>
</body>
</html>
