<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VoidUpLift â€“ Reels Editor</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&family=Anton&family=Bebas+Neue&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
margin:0;
background:#000;
color:#fff;
font-family:Poppins;
height:100vh;
overflow:hidden;
}

/* APP */
.app{
display:flex;
flex-direction:column;
height:100vh;
}

/* PREVIEW */
.preview{
display:flex;
flex-direction:column;
align-items:center;
padding:6px 0;
}

canvas{
width:200px;
height:355px;
background:#000;
border-radius:16px;

/* visual border only */
border:2px solid #2a2a2a;
}

/* PLAY BUTTON */
.playbar{
margin-top:6px;
}
.playbar span{
font-size:30px;
color:#ccc;
cursor:pointer;
}

/* PANEL */
.panel{
flex:1;
background:#050505;
display:flex;
flex-direction:column;
}

/* ICON BAR */
.icon-bar{
display:flex;
justify-content:space-around;
padding:8px 0;
border-top:1px solid #222;
border-bottom:1px solid #222;
}

.icon-bar span{
font-size:26px;
color:#ccc;
cursor:pointer;
}

/* OPTIONS */
.options{
flex:1;
overflow-y:auto;
padding:10px;
display:none;
}
.options.active{display:block}

input,textarea,select,button{
width:100%;
background:#111;
border:1px solid #333;
color:#fff;
padding:10px;
margin-bottom:8px;
font-size:14px;
}

textarea{height:70px}
button{background:#1a1a1a}
a{text-align:center;color:#9ca3af}
</style>
</head>

<body>
<div class="app">

<!-- PREVIEW -->
<div class="preview">
  <canvas id="canvas" width="1080" height="1920"></canvas>
  <div class="playbar">
    <span id="playBtn" class="material-icons" onclick="togglePlay()">play_arrow</span>
  </div>
</div>

<!-- PANEL -->
<div class="panel">

<div class="icon-bar">
  <span class="material-icons" onclick="show('textOpt')">text_fields</span>
  <span class="material-icons" onclick="show('fontOpt')">font_download</span>
  <span class="material-icons" onclick="show('colorOpt')">palette</span>
  <span class="material-icons" onclick="show('imgOpt')">image</span>
  <span class="material-icons" onclick="show('audioOpt')">music_note</span>
  <span class="material-icons" onclick="show('timeOpt')">schedule</span>
  <span class="material-icons" onclick="show('exportOpt')">movie</span>
</div>

<div class="options active" id="textOpt">
  <textarea id="text" placeholder="Drag text on reel..."></textarea>
</div>

<div class="options" id="fontOpt">
  <select id="font">
    <option>Poppins</option>
    <option>Anton</option>
    <option>Bebas Neue</option>
    <option>Playfair Display</option>
  </select>
  <select id="weight">
    <option value="400">Normal</option>
    <option value="700">Bold</option>
    <option value="900">Extra Bold</option>
  </select>
</div>

<div class="options" id="colorOpt">
  <input type="color" id="color" value="#ffffff">
</div>

<div class="options" id="imgOpt">
  <input type="file" id="imgInput" accept="image/*">
</div>

<div class="options" id="audioOpt">
  <input type="file" id="audioInput" accept="audio/*">
</div>

<div class="options" id="timeOpt">
  <label>Reel Duration (seconds)</label>
  <input type="number" id="duration" min="5" max="60" value="17">
</div>

<div class="options" id="exportOpt">
  <button onclick="exportVideo()">Export Video</button>
  <a id="dl" hidden>Download Video</a>
</div>

</div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let img = new Image();
let audio = null;
let txt = "";
let tx = 120, ty = 160;
let font = "Poppins";
let weight = "700";
let color = "#fff";
let duration = 17;

let playing = false;
let previewTime = 0;
let lastFrame = 0;
let drag = false;

/* UI */
function show(id){
document.querySelectorAll(".options").forEach(o=>o.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

/* Inputs */
imgInput.onchange = e => img.src = URL.createObjectURL(e.target.files[0]);
audioInput.onchange = e => audio = new Audio(URL.createObjectURL(e.target.files[0]));
text.oninput = e => txt = e.target.value;
font.onchange = e => font = e.target.value;
weight.onchange = e => weight = e.target.value;
color.oninput = e => color = e.target.value;
duration.oninput = e => duration = Math.max(5, Math.min(60, e.target.value));

/* Drag text */
canvas.onpointerdown = () => drag = true;
canvas.onpointermove = e => {
if(drag){
const r = canvas.getBoundingClientRect();
tx = (e.clientX - r.left) * (1080 / r.width);
ty = (e.clientY - r.top) * (1920 / r.height);
}};
canvas.onpointerup = () => drag = false;

/* Wrap text */
function wrap(text,x,y,max,l){
let words = text.split(" "), line="";
for(let i=0;i<words.length;i++){
let test=line+words[i]+" ";
if(ctx.measureText(test).width>max){
ctx.fillText(line,x,y);
line=words[i]+" ";
y+=l;
}else line=test;
}
ctx.fillText(line,x,y);
}

/* Draw frame */
function draw(time){
ctx.clearRect(0,0,canvas.width,canvas.height);

const creditStart = duration - 3;
if(time >= creditStart){
ctx.fillStyle="#fff";
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="#000";
ctx.font="90px Playfair Display";
ctx.textAlign="center";
ctx.fillText("VoidUpLift",canvas.width/2,canvas.height/2);
return;
}

ctx.fillStyle="#000";
ctx.fillRect(0,0,canvas.width,canvas.height);

/* Text */
ctx.fillStyle=color;
ctx.font=`${weight} 60px ${font}`;
ctx.textAlign="left";
wrap(txt,tx,ty,canvas.width-200,70);

/* Image full width */
if(img.width){
let s = canvas.width / img.width;
let h = img.height * s;
ctx.drawImage(img,0,(canvas.height-h)/2+200,canvas.width,h);
}
}

/* PLAY / PAUSE */
const playBtn = document.getElementById("playBtn");

function togglePlay(){
if(playing){
playing=false;
playBtn.textContent="play_arrow";
if(audio) audio.pause();
}else{
playing=true;
playBtn.textContent="pause";
previewTime=0;
lastFrame=performance.now();
if(audio){audio.currentTime=0;audio.play();}
requestAnimationFrame(loop);
}
}

function loop(now){
if(!playing) return;
previewTime += (now-lastFrame)/1000;
lastFrame = now;
if(previewTime>duration){
playing=false;
playBtn.textContent="play_arrow";
if(audio) audio.pause();
return;
}
draw(previewTime);
requestAnimationFrame(loop);
}

/* EXPORT */
function exportVideo(){
let mime = MediaRecorder.isTypeSupported("video/mp4") ? "video/mp4" : "video/webm";
const stream = canvas.captureStream(30);

if(audio){
const ctxA = new AudioContext();
const src = ctxA.createMediaElementSource(audio);
const dest = ctxA.createMediaStreamDestination();
src.connect(dest);
src.connect(ctxA.destination);
dest.stream.getTracks().forEach(t=>stream.addTrack(t));
audio.currentTime=0;
audio.play();
}

const rec = new MediaRecorder(stream,{mimeType:mime});
const data=[];
rec.ondataavailable=e=>data.push(e.data);
rec.onstop=()=>{
const blob = new Blob(data,{type:mime});
dl.href=URL.createObjectURL(blob);
dl.download="VoidUpLift_Reel."+ (mime.includes("mp4")?"mp4":"webm");
dl.hidden=false;
dl.textContent="Download Video";
};
rec.start();

let t=0;
const i=setInterval(()=>{
t+=0.033;
draw(t);
if(t>=duration){
clearInterval(i);
rec.stop();
if(audio) audio.pause();
}
},33);
}
</script>
</body>
</html>
