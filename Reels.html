<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VoidUpLift Pro - High Performance Reel Editor</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&family=Anton&family=Bebas+Neue&family=Cinzel:wght@700&family=Oswald:wght@500&family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
    :root { 
        --accent: #00ff88; 
        --bg: #050505; 
        --panel: #111; 
        --border: #222;
        --text-dim: #888;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
    
    body { 
        background: #000; 
        color: #fff; 
        font-family: 'Poppins', sans-serif; 
        height: 100vh; 
        overflow: hidden; 
    }

    /* Layout */
    .app-container {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: auto auto 1fr;
        height: 100vh;
    }

    /* 1. Preview Section */
    .preview-section {
        background: #0a0a0a;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid var(--border);
        position: relative;
    }

    #canvasWrapper {
        position: relative;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        border: 2px solid #333;
        border-radius: 8px;
        overflow: hidden;
    }

    canvas {
        width: 42vw; 
        max-width: 190px; 
        aspect-ratio: 9/16;
        display: block;
        cursor: move;
        background: #000;
    }

    .canvas-hint {
        position: absolute;
        bottom: 5px;
        width: 100%;
        text-align: center;
        font-size: 8px;
        color: var(--accent);
        text-transform: uppercase;
        letter-spacing: 1px;
        pointer-events: none;
        opacity: 0.6;
    }

    .playback-bar {
        width: 100%;
        max-width: 400px;
        margin-top: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    #playBtn { 
        font-size: 38px; 
        color: var(--accent); 
        cursor: pointer; 
        transition: 0.2s; 
    }
    
    #playBtn:hover { transform: scale(1.1); }

    input[type="range"] {
        flex: 1;
        accent-color: var(--accent);
        cursor: pointer;
        height: 4px;
    }

    /* 2. Navigation */
    .nav-tabs {
        display: flex;
        justify-content: space-around;
        background: var(--bg);
        padding: 15px 0;
        border-bottom: 1px solid var(--border);
    }

    .nav-tabs span {
        font-size: 26px;
        color: #555;
        cursor: pointer;
        transition: 0.3s;
    }

    .nav-tabs span.active {
        color: var(--accent);
        text-shadow: 0 0 10px rgba(0,255,136,0.3);
    }

    /* 3. Settings Area */
    .settings-area {
        background: var(--bg);
        overflow-y: auto;
        padding: 20px;
        padding-bottom: 100px;
    }

    .panel { display: none; animation: slideUp 0.3s ease-out; }
    .panel.active { display: block; }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    h3 { font-size: 14px; margin-bottom: 15px; color: var(--accent); text-transform: uppercase; }

    .control-group { margin-bottom: 20px; }
    
    label {
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        text-transform: uppercase;
        color: var(--text-dim);
        margin-bottom: 8px;
        letter-spacing: 1px;
    }

    label span { color: var(--accent); }

    input[type="text"], textarea, select, input[type="number"] {
        width: 100%;
        background: var(--panel);
        border: 1px solid var(--border);
        color: #fff;
        padding: 12px;
        border-radius: 6px;
        font-family: inherit;
        font-size: 13px;
    }

    textarea { height: 70px; resize: none; border-left: 3px solid var(--accent); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    .btn-main {
        background: var(--accent);
        color: #000;
        border: none;
        padding: 16px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .color-input { height: 40px; padding: 2px; cursor: pointer; }

    /* Export Overlay */
    #exportOverlay {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.95);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    .loader {
        width: 60px; height: 60px;
        border: 4px solid #222;
        border-top: 4px solid var(--accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Credit Screen Customization */
    .credit-box {
        border: 1px dashed #444;
        padding: 10px;
        border-radius: 6px;
        margin-top: 10px;
    }

</style>
</head>
<body>

<div id="exportOverlay">
    <div class="loader"></div>
    <h2 style="margin: 20px 0 5px">VOIDUPLIFT EXPORT</h2>
    <p id="exportProgress" style="color: var(--accent); font-weight: bold;">0%</p>
    <p style="font-size: 10px; color: #666; margin-top: 10px">DO NOT CLOSE TAB WHILE RENDERING</p>
</div>

<div class="app-container">
    
    <section class="preview-section">
        <div id="canvasWrapper">
            <canvas id="mainCanvas" width="1080" height="1920"></canvas>
            <div class="canvas-hint">Drag Text to Reposition</div>
        </div>
        
        <div class="playback-bar">
            <span id="playBtn" class="material-icons">play_circle_filled</span>
            <input type="range" id="timeline" min="0" step="0.01" value="0">
        </div>
        <div id="timer" style="font-size: 11px; color: #444; margin-top: 5px">00:00 / 00:00</div>
    </section>

    <nav class="nav-tabs">
        <span class="material-icons active" onclick="showPanel(this, 'text-panel')">title</span>
        <span class="material-icons" onclick="showPanel(this, 'style-panel')">palette</span>
        <span class="material-icons" onclick="showPanel(this, 'media-panel')">photo_library</span>
        <span class="material-icons" onclick="showPanel(this, 'fx-panel')">auto_awesome</span>
        <span class="material-icons" onclick="startExport()" style="color:var(--accent)">cloud_download</span>
    </nav>

    <main class="settings-area">
        
        <div id="text-panel" class="panel active">
            <h3>Content Editor</h3>
            <div class="control-group">
                <label>Main Headline</label>
                <textarea id="mainText">THE UNIVERSE IS WITHIN YOU.</textarea>
            </div>
            <div class="control-group">
                <label>Entrance Animation</label>
                <select id="animType">
                    <option value="none">Static</option>
                    <option value="fade">Smooth Fade</option>
                    <option value="slide">Slide From Bottom</option>
                    <option value="typewriter">Typewriter</option>
                </select>
            </div>
        </div>

        <div id="style-panel" class="panel">
            <h3>Visual Style</h3>
            <div class="control-group">
                <label>Typography</label>
                <select id="fontFam">
                    <option value="Anton">Anton (Heavy)</option>
                    <option value="Bebas Neue">Bebas (Clean)</option>
                    <option value="Cinzel">Cinzel (Luxury)</option>
                    <option value="Pacifico">Pacifico (Script)</option>
                    <option value="Oswald">Oswald (Modern)</option>
                </select>
            </div>
            <div class="grid-2">
                <div class="control-group">
                    <label>Size: <span id="sizeVal">120</span>px</label>
                    <input type="range" id="fontSize" min="30" max="400" value="120">
                </div>
                <div class="control-group">
                    <label>Text Color</label>
                    <input type="color" id="fontColor" class="color-input" value="#ffffff">
                </div>
            </div>
            <div class="control-group">
                <label>Letter Spacing</label>
                <input type="range" id="letterSpacing" min="-10" max="50" value="0">
            </div>
        </div>

        <div id="media-panel" class="panel">
            <h3>Media & Layers</h3>
            <div class="control-group">
                <label>Centered Image Overlay</label>
                <input type="file" id="imgUpload" accept="image/*">
            </div>
            <div class="control-group">
                <label>Image Scale: <span id="scaleVal">80</span>%</label>
                <input type="range" id="imgScale" min="10" max="200" value="80">
            </div>
            <div class="control-group">
                <label>Audio Track</label>
                <input type="file" id="audioUpload" accept="audio/*">
            </div>
            <div class="control-group">
                <label>Video Duration (Seconds)</label>
                <input type="number" id="vidDur" value="6" min="1" max="60">
            </div>
        </div>

        <div id="fx-panel" class="panel">
            <h3>Creative Effects</h3>
            <div class="control-group">
                <label>Neon Glow Strength</label>
                <input type="range" id="glowSize" min="0" max="60" value="20">
            </div>
            <div class="control-group">
                <label>Beat-Sync Pulse</label>
                <select id="pulseEffect">
                    <option value="0">Disabled</option>
                    <option value="1">Soft Pulse</option>
                    <option value="2">Aggressive Bounce</option>
                </select>
            </div>
            <div class="credit-box">
                <label>End Credits (VoidUpLift)</label>
                <input type="text" id="creditName" value="VOIDUPLIFT ENGINE">
                <p style="font-size: 8px; color:#555; margin-top:5px">Fades in during the last 2 seconds.</p>
            </div>
            <button class="btn-main" onclick="applyMagicTheme()">âœ¨ AI Magic Theme</button>
        </div>

    </main>
</div>

<script>
    /**
     * ENGINE INITIALIZATION
     */
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    const timeline = document.getElementById('timeline');
    
    let overlayImg = new Image();
    let audio = null;
    let isPlaying = false;
    let currentTime = 0;
    let lastFrameTime = 0;

    // Config Object
    const state = {
        text: "THE UNIVERSE IS WITHIN YOU.",
        x: 540, y: 960, // Centered start
        size: 120,
        font: "Anton",
        color: "#ffffff",
        glow: 20,
        imgScale: 0.8,
        duration: 6,
        endScreenDur: 2.5,
        spacing: 0,
        anim: "fade",
        pulse: 0,
        credits: "VOIDUPLIFT ENGINE",
        isDragging: false
    };

    /**
     * CORE RENDER LOOP
     */
    function render(t) {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, 1080, 1920);

        const totalTime = state.duration + state.endScreenDur;
        const isEndScreen = t > state.duration;

        // Pulse Calculation
        let pulseFactor = 1;
        if(state.pulse > 0 && isPlaying) {
            pulseFactor = 1 + (Math.sin(t * 10) * (state.pulse * 0.03));
        }

        if(!isEndScreen) {
            // 1. Render Centered Media
            if(overlayImg.src) {
                const aspect = overlayImg.width / overlayImg.height;
                const w = 1080 * state.imgScale * pulseFactor;
                const h = w / aspect;
                
                ctx.save();
                ctx.shadowBlur = 40;
                ctx.shadowColor = "rgba(0,0,0,0.8)";
                ctx.drawImage(overlayImg, (1080-w)/2, (1920-h)/2, w, h);
                ctx.restore();
            }

            // 2. Render Draggable Text
            ctx.save();
            let alpha = 1;
            let drawY = state.y;

            if(state.anim === "fade") alpha = Math.min(1, t / 1.5);
            if(state.anim === "slide") drawY = state.y + (Math.max(0, 1 - t) * 300);
            
            ctx.globalAlpha = alpha;
            ctx.font = `${state.size * pulseFactor}px ${state.font}`;
            ctx.fillStyle = state.color;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.letterSpacing = `${state.spacing}px`;

            if(state.glow > 0) {
                ctx.shadowColor = state.color;
                ctx.shadowBlur = state.glow;
            }

            let displayText = state.text;
            if(state.anim === "typewriter") {
                displayText = state.text.substring(0, Math.floor(t * 15));
            }

            ctx.fillText(displayText, state.x, drawY);
            ctx.restore();
        } else {
            // --- VOIDUPLIFT END SCREEN ---
            const et = t - state.duration; // End screen relative time
            ctx.fillStyle = "#050505";
            ctx.fillRect(0,0,1080,1920);

            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            
            // Logo
            ctx.globalAlpha = Math.min(1, et * 2);
            ctx.fillStyle = varColor('--accent');
            ctx.font = "bold 90px Anton";
            ctx.fillText("VOIDUPLIFT", 540, 900);

            // Credit Name
            ctx.globalAlpha = Math.min(1, (et - 0.5) * 2);
            ctx.fillStyle = "#fff";
            ctx.font = "40px Poppins";
            ctx.letterSpacing = "4px";
            ctx.fillText(state.credits.toUpperCase(), 540, 1000);
        }
    }

    // Helper to get CSS variable color
    function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

    /**
     * INTERACTION: DRAG & INPUTS
     */
    let isMouseDown = false;
    canvas.addEventListener('mousedown', () => isMouseDown = true);
    window.addEventListener('mouseup', () => isMouseDown = false);
    
    canvas.addEventListener('mousemove', (e) => {
        if(!isMouseDown) return;
        const rect = canvas.getBoundingClientRect();
        const scaleX = 1080 / rect.width;
        const scaleY = 1920 / rect.height;
        state.x = (e.clientX - rect.left) * scaleX;
        state.y = (e.clientY - rect.top) * scaleY;
        render(currentTime);
    });

    // Binding Inputs
    const bind = (id, key, labelId = null) => {
        const el = document.getElementById(id);
        el.oninput = () => {
            state[key] = el.type === 'number' || el.type === 'range' ? parseFloat(el.value) : el.value;
            if(labelId) document.getElementById(labelId).innerText = el.value;
            updateTimeline();
            render(currentTime);
        };
    };

    bind('mainText', 'text');
    bind('fontSize', 'size', 'sizeVal');
    bind('fontFam', 'font');
    bind('fontColor', 'color');
    bind('imgScale', 'imgScale', 'scaleVal', (v) => v/100);
    bind('vidDur', 'duration');
    bind('letterSpacing', 'spacing');
    bind('glowSize', 'glow');
    bind('animType', 'anim');
    bind('pulseEffect', 'pulse');
    bind('creditName', 'credits');

    // Override imgScale special logic
    document.getElementById('imgScale').oninput = (e) => {
        state.imgScale = e.target.value / 100;
        document.getElementById('scaleVal').innerText = e.target.value;
        render(currentTime);
    };

    document.getElementById('imgUpload').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (f) => { overlayImg.src = f.target.result; overlayImg.onload = () => render(currentTime); };
        reader.readAsDataURL(e.target.files[0]);
    };

    document.getElementById('audioUpload').onchange = (e) => {
        audio = new Audio(URL.createObjectURL(e.target.files[0]));
    };

    /**
     * PLAYBACK & FULLSCREEN
     */
    document.getElementById('playBtn').onclick = () => {
        isPlaying = !isPlaying;
        
        if(isPlaying) {
            // FULLSCREEN LOGIC
            const wrapper = document.getElementById('canvasWrapper');
            if (wrapper.requestFullscreen) wrapper.requestFullscreen();
            
            if(audio) { audio.currentTime = currentTime; audio.play(); }
            document.getElementById('playBtn').innerText = "pause_circle_filled";
            lastFrameTime = performance.now();
            requestAnimationFrame(playbackLoop);
        } else {
            document.getElementById('playBtn').innerText = "play_circle_filled";
            if(audio) audio.pause();
            if (document.fullscreenElement) document.exitFullscreen();
        }
    };

    function playbackLoop(now) {
        if(!isPlaying) return;
        let dt = (now - lastFrameTime) / 1000;
        currentTime += dt;
        lastFrameTime = now;

        const total = state.duration + state.endScreenDur;
        if(currentTime >= total) {
            currentTime = 0;
            isPlaying = false;
            document.getElementById('playBtn').innerText = "play_circle_filled";
            if(document.fullscreenElement) document.exitFullscreen();
        }

        timeline.value = currentTime;
        updateTimerLabel();
        render(currentTime);
        requestAnimationFrame(playbackLoop);
    }

    function updateTimeline() {
        timeline.max = state.duration + state.endScreenDur;
        updateTimerLabel();
    }

    function updateTimerLabel() {
        const total = state.duration + state.endScreenDur;
        document.getElementById('timer').innerText = `${currentTime.toFixed(1)}s / ${total.toFixed(1)}s`;
    }

    timeline.oninput = () => {
        currentTime = parseFloat(timeline.value);
        render(currentTime);
    };

    /**
     * EXPORT SYSTEM
     */
    async function startExport() {
        isPlaying = false;
        const overlay = document.getElementById('exportOverlay');
        const prog = document.getElementById('exportProgress');
        overlay.style.display = 'flex';

        const fps = 30;
        const totalTime = state.duration + state.endScreenDur;
        const totalFrames = totalTime * fps;
        
        const stream = canvas.captureStream(fps);
        const recorder = new MediaRecorder(stream, { mimeType: 'video/webm', videoBitsPerSecond: 12000000 });
        const chunks = [];

        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `VoidUpLift_Pro_${Date.now()}.webm`;
            link.click();
            overlay.style.display = 'none';
        };

        recorder.start();
        for(let i=0; i <= totalFrames; i++) {
            render(i / fps);
            prog.innerText = Math.round((i / totalFrames) * 100) + "%";
            await new Promise(r => requestAnimationFrame(r));
        }
        recorder.stop();
    }

    /**
     * UI UTILS
     */
    function showPanel(el, id) {
        document.querySelectorAll('.nav-tabs span').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        el.classList.add('active');
        document.getElementById(id).classList.add('active');
    }

    function applyMagicTheme() {
       
