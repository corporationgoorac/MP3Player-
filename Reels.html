<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoidUpLift Pro - Final Edition</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&family=Anton&family=Bebas+Neue&family=Cinzel:wght@700&family=Oswald:wght@500&family=Pacifico&family=Orbitron:wght@900&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        :root { 
            --accent: #00ff88; 
            --bg: #050505; 
            --panel: #111; 
            --border: #222;
        }

        /* 1. PROTECTION: DISABLE TEXT SELECTION & COPYING */
        * { 
            box-sizing: border-box; margin: 0; padding: 0; outline: none; 
            -webkit-user-select: none; user-select: none;
            -webkit-touch-callout: none;
        }

        input, textarea, select { -webkit-user-select: text; user-select: text; }
        
        body { 
            background: #000; color: #fff; font-family: 'Poppins', sans-serif; 
            height: 100vh; overflow: hidden; 
        }

        .app-container {
            display: grid; grid-template-rows: auto auto 1fr; height: 100vh;
        }

        /* 2. PREVIEW SECTION - EXACT CENTER COVER */
        .preview-section {
            background: #000; display: flex; flex-direction: column;
            align-items: center; padding: 10px; border-bottom: 1px solid var(--border);
        }

        #canvasWrapper {
            position: relative; border: 1px solid #333; border-radius: 4px;
            overflow: hidden; background: #000; line-height: 0;
            box-shadow: 0 0 30px rgba(0,0,0,1);
        }

        canvas {
            width: 45vw; max-width: 210px; aspect-ratio: 9/16;
            cursor: move; display: block;
        }

        /* 3. ACCESSIBLE SCRUBBER */
        .playback-bar {
            width: 95%; max-width: 400px; margin-top: 12px;
            display: flex; align-items: center; gap: 15px;
        }

        #playBtn { font-size: 45px; color: var(--accent); cursor: pointer; }
        
        #timeline { 
            flex: 1; height: 12px; accent-color: var(--accent); 
            cursor: pointer; border-radius: 6px; 
        }

        /* 4. NAVIGATION */
        .nav-tabs {
            display: flex; justify-content: space-around;
            background: #080808; padding: 15px 0; border-bottom: 1px solid var(--border);
        }

        .nav-tabs span { font-size: 26px; color: #444; cursor: pointer; transition: 0.3s; }
        .nav-tabs span.active { color: var(--accent); text-shadow: 0 0 15px rgba(0,255,136,0.5); }

        /* 5. PANELS */
        .settings-area { background: var(--bg); overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .panel { display: none; }
        .panel.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .control-group { margin-bottom: 20px; }
        label { display: flex; justify-content: space-between; font-size: 10px; color: #888; margin-bottom: 8px; text-transform: uppercase; }
        label span { color: var(--accent); }

        input[type="text"], textarea, select, input[type="number"] {
            width: 100%; background: var(--panel); border: 1px solid var(--border);
            color: #fff; padding: 12px; border-radius: 8px; font-size: 13px;
        }

        textarea { height: 70px; resize: none; border-left: 3px solid var(--accent); }

        .btn-main {
            background: var(--accent); color: #000; border: none; padding: 16px;
            border-radius: 8px; font-weight: 700; width: 100%; cursor: pointer;
            text-transform: uppercase; margin-top: 10px;
        }

        #exportOverlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="exportOverlay">
    <div style="width:50px; height:50px; border:4px solid #222; border-top-color:var(--accent); border-radius:50%; animation:spin 1s linear infinite"></div>
    <h2 style="margin-top:20px">RENDERING VOID</h2>
    <p id="exportProgress" style="color:var(--accent); font-size:24px; font-weight:bold">0%</p>
</div>

<div class="app-container">
    <section class="preview-section">
        <div id="canvasWrapper">
            <canvas id="mainCanvas" width="1080" height="1920"></canvas>
        </div>
        <div class="playback-bar">
            <span id="playBtn" class="material-icons">play_circle_filled</span>
            <input type="range" id="timeline" min="0" step="0.01" value="0">
        </div>
        <div id="timer" style="font-size:11px; color:#444; margin-top:8px">0.0s / 8.5s</div>
    </section>

    <nav class="nav-tabs">
        <span class="material-icons active" onclick="showPanel(this, 'text-p')">title</span>
        <span class="material-icons" onclick="showPanel(this, 'style-p')">format_size</span>
        <span class="material-icons" onclick="showPanel(this, 'media-p')">image</span>
        <span class="material-icons" onclick="showPanel(this, 'fx-p')">auto_awesome</span>
        <span class="material-icons" onclick="startExport()" style="color:var(--accent)">download</span>
    </nav>

    <main class="settings-area">
        <div id="text-p" class="panel active">
            <label>Headline (Auto-Wrap)</label>
            <textarea id="mainText">THE UNIVERSE IS WITHIN YOU.</textarea>
        </div>

        <div id="style-p" class="panel">
            <div class="control-group">
                <label>Font Size: <span id="sizeVal">120</span>px</label>
                <input type="range" id="fontSize" min="30" max="450" value="120">
            </div>
            <div class="control-group">
                <label>Typography</label>
                <select id="fontFam">
                    <option value="Anton">Anton (Heavy)</option>
                    <option value="Orbitron">Orbitron (Cyber)</option>
                    <option value="Syncopate">Syncopate (Wide)</option>
                    <option value="Pacifico">Pacifico (Script)</option>
                </select>
            </div>
        </div>

        <div id="media-p" class="panel">
            <label>Upload Background</label>
            <input type="file" id="imgUpload" accept="image/*">
            <div class="control-group" style="margin-top:15px">
                <label>Duration (Seconds)</label>
                <input type="number" id="vidDur" value="6">
            </div>
        </div>

        <div id="fx-p" class="panel">
            <label>End Screen Credits</label>
            <input type="text" id="creditName" value="VOIDUPLIFT ENGINE">
            <button class="btn-main" onclick="applyMagicTheme()">âœ¨ Magic Style</button>
        </div>
    </main>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const timeline = document.getElementById('timeline');
    let overlayImg = new Image();
    let isPlaying = false, currentTime = 0, lastTime = 0;

    const state = {
        text: "THE UNIVERSE IS WITHIN YOU.",
        x: 540, y: 960, size: 120, font: "Anton", color: "#ffffff",
        duration: 6, endDur: 2.5, credits: "VOIDUPLIFT ENGINE"
    };

    /**
     * AUTO-WRAP TEXT LOGIC
     */
    function wrapText(context, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let currentY = y;

        for (let n = 0; n < words.length; n++) {
            let testLine = line + words[n] + ' ';
            let metrics = context.measureText(testLine);
            if (metrics.width > maxWidth && n > 0) {
                context.fillText(line, x, currentY);
                line = words[n] + ' ';
                currentY += lineHeight;
            } else {
                line = testLine;
            }
        }
        context.fillText(line, x, currentY);
    }

    /**
     * RENDER ENGINE
     */
    function render(t) {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, 1080, 1920);

        if (t < state.duration) {
            // 1. IMAGE COVER (EXACT FIT)
            if (overlayImg.src && overlayImg.complete) {
                const scale = Math.max(1080 / overlayImg.width, 1920 / overlayImg.height);
                const w = overlayImg.width * scale;
                const h = overlayImg.height * scale;
                ctx.drawImage(overlayImg, (1080 - w) / 2, (1920 - h) / 2, w, h);
            }

            // 2. TEXT LAYER WITH DRAG & WRAP
            ctx.save();
            ctx.fillStyle = state.color;
            ctx.font = `${state.size}px "${state.font}"`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.shadowColor = "rgba(0,0,0,0.8)";
            ctx.shadowBlur = 20;
            wrapText(ctx, state.text, state.x, state.y, 980, state.size * 1.2);
            ctx.restore();
        } else {
            // 3. VOIDUPLIFT END SCREEN
            const et = t - state.duration;
            ctx.fillStyle = "#050505";
            ctx.fillRect(0,0,1080,1920);
            
            ctx.globalAlpha = Math.min(1, et * 2);
            ctx.fillStyle = "#00ff88";
            ctx.font = "bold 100px Anton";
            ctx.textAlign = "center";
            ctx.fillText("VOIDUPLIFT", 540, 920);

            ctx.globalAlpha = Math.min(1, (et-0.5)*2);
            ctx.fillStyle = "#fff";
            ctx.font = "40px Poppins";
            ctx.fillText(state.credits.toUpperCase(), 540, 1030);
        }
    }

    function showPanel(btn, id) {
        document.querySelectorAll('.nav-tabs span').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(id).classList.add('active');
    }

    /**
     * INTERACTIONS
     */
    let isDown = false;
    canvas.onmousedown = () => isDown = true;
    window.onmouseup = () => isDown = false;
    canvas.onmousemove = (e) => {
        if (!isDown) return;
        const r = canvas.getBoundingClientRect();
        state.x = (e.clientX - r.left) * (1080 / r.width);
        state.y = (e.clientY - r.top) * (1920 / r.height);
        render(currentTime);
    };

    document.getElementById('fontSize').oninput = (e) => {
        state.size = e.target.value;
        document.getElementById('sizeVal').innerText = e.target.value;
        render(currentTime);
    };
    document.getElementById('mainText').oninput = (e) => { state.text = e.target.value; render(currentTime); };
    document.getElementById('fontFam').onchange = (e) => { state.font = e.target.value; render(currentTime); };
    document.getElementById('vidDur').oninput = (e) => { state.duration = parseFloat(e.target.value); updateTimeline(); };
    document.getElementById('creditName').oninput = (e) => { state.credits = e.target.value; };

    document.getElementById('imgUpload').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (f) => { 
            overlayImg = new Image();
            overlayImg.src = f.target.result; 
            overlayImg.onload = () => render(currentTime); 
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    /**
     * PLAYBACK
     */
    document.getElementById('playBtn').onclick = () => {
        isPlaying = !isPlaying;
        document.getElementById('playBtn').innerText = isPlaying ? "pause_circle_filled" : "play_circle_filled";
        if (isPlaying) { lastTime = performance.now(); requestAnimationFrame(loop); }
    };

    function loop(now) {
        if (!isPlaying) return;
        currentTime += (now - lastTime) / 1000;
        lastTime = now;
        if (currentTime > state.duration + state.endDur) currentTime = 0;
        timeline.value = currentTime;
        document.getElementById('timer').innerText = `${currentTime.toFixed(1)}s / ${(state.duration+state.endDur).toFixed(1)}s`;
        render(currentTime);
        requestAnimationFrame(loop);
    }

    function updateTimeline() { timeline.max = state.duration + state.endDur; }
    timeline.oninput = () => { currentTime = parseFloat(timeline.value); render(currentTime); };

    function applyMagicTheme() {
        state.font = "Orbitron"; state.size = 150; state.text = "LEVEL UP";
        document.getElementById('fontFam').value = "Orbitron";
        document.getElementById('fontSize').value = 150;
        document.getElementById('mainText').value = "LEVEL UP";
        render(currentTime);
    }

    async function startExport() {
        document.getElementById('exportOverlay').style.display = 'flex';
        const stream = canvas.captureStream(30);
        const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob(chunks));
            link.download = `VoidReel_Final.webm`;
            link.click();
            document.getElementById('exportOverlay').style.display = 'none';
        };
        recorder.start();
        const frames = (state.duration + state.endDur) * 30;
        for(let i=0; i<=frames; i++) {
            render(i/30);
            document.getElementById('exportProgress').innerText = Math.round((i/frames)*100) + "%";
            await new Promise(r => requestAnimationFrame(r));
        }
        recorder.stop();
    }

    window.onload = () => { updateTimeline(); render(0); };
</script>

<style> @keyframes spin { to { transform: rotate(360deg); } } </style>
</body>
</html>
